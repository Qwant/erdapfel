{"version":3,"sources":["webpack:///./local_modules/mapbox_style_configure/index.js","webpack:///./src/components/PoiPopup.jsx","webpack:///./src/adapters/poi_popup.js","webpack:///./src/mapbox/mobile_compass_control.js","webpack:///./src/mapbox/extended_scale_control.js","webpack:///./src/mapbox/extended_attribution_control.js","webpack:///./src/libs/renderStaticReact.js","webpack:///./src/mapbox/extended_geolocate_control.js","webpack:///./src/mapbox/extended_nav_control.js","webpack:///./src/adapters/poi/map_poi.js","webpack:///./src/adapters/scene_config.js","webpack:///./src/panel/direction/RouteLabel/index.jsx","webpack:///./src/adapters/route_styles.js","webpack:///./src/adapters/scene_direction.js","webpack:///./src/adapters/pois_styles.js","webpack:///./src/adapters/scene_category.js","webpack:///./src/mapbox/locale.js","webpack:///./src/adapters/scene.js"],"names":["module","exports","configure","style","mapStyleConfig","lang","JSON","parse","replace","baseMapUrl","poiMapUrl","spritesUrl","fontsUrl","PoiPopup","poi","useFavorites","isInFavorites","removeFromFavorites","addToFavorites","isDirectionActive","useConfig","enabled","openDirection","Telemetry","sendPoiEvent","window","app","navigateTo","onClickPhoneNumber","source","meta","buildInteractionData","id","template","zone","element","toggleStorePoi","e","preventDefault","isFavorite","stored","fire","WAIT_BEFORE_DISPLAY","WAIT_BEFORE_CLOSE","undefined","prototype","init","map","popupHandle","timeOutHandler","activePoiId","closeTimeoutHandler","listen","isMobileDevice","isTouchEvent","createPJPopup","close","clearTimeout","setTimeout","addListener","layer","on","features","properties","global_id","createOSMPopup","originalEvent","layerPoi","event","ApiPoi","poiApiLoad","simple","showPopup","popupOptions","className","closeButton","maxWidth","offset","anchor","getPopupAnchor","Popup","setLngLat","latLon","setHTML","addTo","popupWrapper","document","querySelector","ReactDOM","render","VERTICAL_OFFSET","HORIZONTAL_OFFSET","canvasWidth","innerWidth","anchorFragments","clientY","push","clientX","join","unmountComponentAtNode","remove","sourceCapabilities","firesTouchEvents","MobileCompassControl","_container","createElement","compassClass","_compass","_createButton","_resetNorthAndTilt","compassIndicatorClass","_compassIndicator","_createIcon","appendChild","_map","textContent","_pitchAndRotateCompassArrow","bind","parentNode","removeChild","navigator","geolocation","getCurrentPosition","position","flyTo","center","coords","longitude","latitude","maximumAge","ariaLabel","fn","a","setAttribute","addEventListener","easeTo","pitch","bearing","getPitch","transform","angle","classList","add","scale","rotation","Math","PI","ExtendedScaleControl","options","container","parentContainer","_onMove","ScaleControl","ExtendedAttributionControl","AttributionControl","reactElement","ReactDOMServer","renderToStaticMarkup","ExtendedGeolocateControl","addOnce","LOCALISE_TRIGGER","_setupUI","cb","_onReady","Geolocation","state","PROMPT","store","openPendingGeolocateModal","supported","_geolocateButton","firstChild","innerHTML","renderStaticReact","error","disabled","GeolocateControl","ExtendedControl","topButtonGroup","bottomButtonGroup","directionShortcutCallback","_zoomInButton","MAP_ZOOM_IN","zoomIn","_zoomOutButton","MAP_ZOOM_OUT","zoomOut","_direction","MAP_ITINERARY","geolocControl","GeolocControl","positionOptions","enableHighAccuracy","trackUserLocation","showAccuracyCircle","onReady","addControl","scaleAttributionContainer","extendedScaleControl","unit","extendedAttributionControl","unListen","MapPoi","feature","subClassName","subclass","name","ll","LngLat","convert","geometry","coordinates","POI_TYPE","Poi","nconf","get","mapStyle","baseUrl","system","sceneConfig","Object","assign","URI","toAbsoluteUrl","location","origin","getStyle","stringify","qwantStyle","getBaseLang","code","VEHICLES","TRAIN","SUBWAY","BUS_CITY","TRAM","PublicTransportIcon","mode","PublicTransportStepIcons","route","nonWalkLegs","legs","filter","leg","length","index","RouteLabel","vehicle","isPublicTransport","formatDuration","duration","formatDistance","distance","darkenColor","hex","Color","mix","safeHexColor","charAt","prepareRouteColor","lineColor","outlineColor","getColorExpression","isActive","isOutline","GREY_GREY","GREY_SEMI_LIGHTNESS","getRouteStyle","type","layout","visibility","paint","setActiveRouteStyle","layerId","setLayoutProperty","setPaintProperty","createMarker","lngLat","Marker","createRouteLabel","onclick","getLabelsBbbox","labelPositions","routesBbox","smallScreen","shift","latShift","getNorth","getSouth","lngShift","getEast","getWest","labelsBbbox","LngLatBounds","shiftLabelPosition","forEach","labelPosition","extend","lng","lat","SceneDirection","originMarker","draggable","refreshDirection","target","getLngLat","routeMarkers","destinationMarker","routes","routeLabels","fullBbox","mapFeaturesByRoute","iconsBaseUrl","addMapImage","pixelRatio","activeRouteId","reset","displayRoutes","routeId","fitView","setMainRoute","step","computeBBox","highlightStep","unhighlightStep","setOrigin","setDestination","getAllSteps","idx","stepMarker","maneuver","getElement","getAllStops","stop","stopMarker","title","mainRoute","outlineLayerId","moveLayer","routes_layer","updateMarkers","updateRouteLabels","marker","addMarkerSteps","originDestinationCoords","destination","addRouteFeatures","getLabelPositions","querySelectorAll","routeLabel","dataset","toString","newPoint","LatLonPoi","sourceId","removeLayer","removeSource","concat","featureCollection","normalizeToFeatureCollection","sources","walkFeatures","nonWalkFeatures","data","getDataSources","addSource","layerStyle","outlineLayerStyle","addLayer","getCanvas","cursor","bbox","minX","minY","maxX","maxY","url","loadImage","image","Error","sendOnce","addImage","getFilteredPoisPinStyle","getFilteredPoisLabelStyle","RED_DARKER","GREY_BLACK","setPoiHoverStyle","poiLayer","getPaintProperty","textColorProperty","ACTION_BLUE_BASE","validate","poisToGeoJSON","pois","poiFeature","poiToGeoJSON","iconName","IconManager","iconClass","SceneCategory","hoveredPoi","hoveredMarker","createPinIcon","disablePointerEvents","selectedPoi","selectedMarker","createMapGLIcon","then","imageData","sourceName","emptyFeatureCollection","promoteId","showNamesWithPins","labelLayerId","layers","pinLayerId","layerName","handleLayerMarkerClick","handleLayerMarkerMouseOver","handleLayerMarkerMouseLeave","mapMouseEvent","find","p","poiFilters","category","toUrl","centerMap","selectPoiMarker","stopPropagation","getPointedPoi","selectPoi","highlightPoiMarker","setOsmPoisVisibility","getSource","setData","displayed","constants","pois_layers","setFeatureState","highlight","setPoiFeatureState","hovered","selected","initActiveStateMarkers","initDynamicPoiLayers","addCategoryMarkers","removeCategoryMarkers","defaultLocale","_","LONG_TOUCH_DELAY_MS","MOBILE_IDLE_DELAY_MS","MOBILE_IDLE_TIMEOUT","Scene","currentMarker","popup","savedLocation","getPoiView","zoom","getBestZoom","bounds","hideMobileScale","item","showMobileScale","getMapInitOptions","locationHash","parseBboxString","console","hotLoadPoi","lastLocation","getLastLocation","initialBbox","fitBoundsOptions","maxZoom","mapConfig","initMapBox","times","Date","now","compilationHash","__config","setRTLTextPlugin","send","mb","Map","attributionControl","hash","locale","setPadding","getCurrentMapPaddings","interactiveLayers","DOUBLE_TAP_DELAY_MS","lastDoubleTapTimeStamp","lastTouchEndTimeStamp","timeStamp","onHashChange","interactiveLayer","hover","clickDelayHandler","cancelBubble","detail","queryRenderedFeatures","point","clickOnMap","longTouchTimeout","touches","longTouch","cancelClickAfterLongTouch","longTouchCancellingEvents","cancelLongTouch","getCenter","getZoom","setLastLocation","updateHash","getLocationHash","execOnMapLoaded","f","forceAnimate","fitMap","ensureMarkerIsVisible","addMarker","cleanMarker","saveLocation","restoreLocation","bottom","moveMobileBottomUI","moveMobileGeolocationButton","visible","mobileButtonVisibility","clickedFeature","parseMapHash","flyOptions","animate","screenSpeed","clamp","min","max","value","isBBoxInExtendedViewport","viewport","getBounds","width","height","setNorthEast","wrap","setSouthWest","contains","getNorthWest","getNorthEast","getSouthEast","getSouthWest","fitBbox","Array","fitBounds","isArray","isWindowedPoi","isMobile","isPoiUnderPanel","isPositionUnderUI","project","maxDuration","createDefaultPin","getMapHash","restoreFromHash","zll","onhashchange","translateUIControl","selector","uiControls","uiControl"],"mappings":"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","file":"map-4c34900529adf30bfdb5.bundle.js","sourcesContent":["module.exports = function configure(style, mapStyleConfig, lang) {\n  return JSON.parse(style\n    .replace(/\\{locale\\}/g, lang)\n    .replace('\"{tileserver_base}\"', mapStyleConfig.baseMapUrl)\n    .replace('\"{tileserver_poi}\"', mapStyleConfig.poiMapUrl)\n    .replace('{spriteserver}', mapStyleConfig.spritesUrl)\n    .replace('{fontserver}', mapStyleConfig.fontsUrl)\n  )\n}\n","import React from 'react';\nimport PoiItem from './PoiItem';\nimport { fire } from 'src/libs/customEvents';\nimport ActionButtons from '../panel/poi/ActionButtons';\nimport Telemetry from '../libs/telemetry';\nimport { useConfig, useFavorites } from '../hooks';\n\nconst PoiPopup = ({ poi }) => {\n  const { isInFavorites, removeFromFavorites, addToFavorites } = useFavorites();\n  const isDirectionActive = useConfig('direction').enabled;\n\n  const openDirection = () => {\n    Telemetry.sendPoiEvent(poi, 'itinerary');\n    window.app.navigateTo('/routes/', { poi });\n  };\n\n  const onClickPhoneNumber = () => {\n    const source = poi.meta && poi.meta.source;\n    if (source) {\n      Telemetry.sendPoiEvent(\n        poi,\n        'phone',\n        Telemetry.buildInteractionData({\n          id: poi.id,\n          source,\n          template: 'single',\n          zone: 'detail',\n          element: 'phone',\n        })\n      );\n    }\n  };\n\n  const toggleStorePoi = e => {\n    e?.preventDefault();\n    const isFavorite = isInFavorites(poi);\n    Telemetry.sendPoiEvent(poi, 'favorite', { stored: !isFavorite });\n    if (isFavorite) {\n      removeFromFavorites(poi);\n    } else {\n      addToFavorites(poi);\n    }\n  };\n\n  return (\n    <div\n      className=\"poi_popup\"\n      onMouseEnter={() => {\n        fire('stop_close_popup_timeout');\n      }}\n      onMouseLeave={() => {\n        fire('close_popup');\n      }}\n    >\n      <div className=\"u-mb-s\">\n        <PoiItem poi={poi} withOpeningHours withImage inList />\n      </div>\n      <ActionButtons\n        poi={poi}\n        isDirectionActive={isDirectionActive}\n        openDirection={openDirection}\n        onClickPhoneNumber={onClickPhoneNumber}\n        isPoiInFavorite={isInFavorites(poi)}\n        toggleStorePoi={toggleStorePoi}\n      />\n    </div>\n  );\n};\n\nexport default PoiPopup;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Popup } from 'mapbox-gl--ENV';\nimport ApiPoi from './poi/idunn_poi';\nimport { isMobileDevice } from 'src/libs/device';\nimport ReactPoiPopup from 'src/components/PoiPopup';\nimport { fire, listen } from 'src/libs/customEvents';\n\nconst WAIT_BEFORE_DISPLAY = 350;\nconst WAIT_BEFORE_CLOSE = 350;\n\nfunction PoiPopup() {\n  return undefined;\n}\n\nPoiPopup.prototype.init = function (map) {\n  this.map = map;\n  this.popupHandle = null;\n  this.timeOutHandler = null;\n  this.activePoiId = null;\n  this.closeTimeoutHandler = null;\n\n  listen('open_popup', (poi, e) => {\n    if (isMobileDevice() || isTouchEvent(e)) {\n      return;\n    }\n    this.createPJPopup(poi, e);\n    fire('stop_close_popup_timeout');\n  });\n  listen('close_popup', () => this.close());\n  listen('clean_marker', () => {\n    this.close();\n    this.activePoiId = null;\n  });\n\n  listen('stop_close_popup_timeout', () => clearTimeout(this.closeTimeoutHandler));\n  listen('start_close_popup_timeout', () => {\n    clearTimeout(this.closeTimeoutHandler);\n    this.closeTimeoutHandler = setTimeout(() => {\n      fire('close_popup');\n    }, WAIT_BEFORE_CLOSE);\n  });\n};\n\nPoiPopup.prototype.addListener = function (layer) {\n  this.map.on('mouseenter', layer, e => {\n    if (isMobileDevice() || isTouchEvent(e)) {\n      return;\n    }\n    this.timeOutHandler = setTimeout(() => {\n      const poi = e.features[0];\n      if (this.activePoiId === poi.properties.global_id) {\n        return;\n      }\n      this.createOSMPopup(poi, e.originalEvent);\n    }, WAIT_BEFORE_DISPLAY);\n  });\n\n  this.map.on('click', () => {\n    this.close();\n  });\n\n  this.map.on('mouseleave', layer, async () => {\n    clearTimeout(this.timeOutHandler);\n    fire('start_close_popup_timeout');\n  });\n};\n\nPoiPopup.prototype.createOSMPopup = async function (layerPoi, event) {\n  const poi = await ApiPoi.poiApiLoad({ id: layerPoi.properties.global_id }, { simple: true });\n  if (poi) {\n    this.showPopup(poi, event);\n  }\n};\n\nPoiPopup.prototype.createPJPopup = function (poi, event) {\n  if (poi) {\n    this.showPopup(poi, event);\n  }\n};\n\nPoiPopup.prototype.showPopup = function (poi, event) {\n  this.close();\n\n  const popupOptions = {\n    className: 'poi_popup__container',\n    closeButton: false,\n    maxWidth: 'none',\n    offset: 18, //px,\n    anchor: this.getPopupAnchor(event),\n  };\n\n  this.popupHandle = new Popup(popupOptions)\n    .setLngLat(poi.latLon)\n    .setHTML('<div class=\"poi_popup__wrapper\"/></div>')\n    .addTo(this.map);\n\n  const popupWrapper = document.querySelector('.poi_popup__wrapper');\n  if (popupWrapper) {\n    ReactDOM.render(<ReactPoiPopup poi={poi} />, popupWrapper);\n  }\n};\n\nPoiPopup.prototype.getPopupAnchor = function (event) {\n  const VERTICAL_OFFSET = 250;\n  const HORIZONTAL_OFFSET = 300;\n  const canvasWidth = window.innerWidth;\n  const anchorFragments = [];\n\n  if (event) {\n    if (event.clientY > VERTICAL_OFFSET) {\n      anchorFragments.push('bottom');\n    } else {\n      anchorFragments.push('top');\n    }\n\n    if (event.clientX < canvasWidth - HORIZONTAL_OFFSET) {\n      anchorFragments.push('left');\n    } else {\n      anchorFragments.push('right');\n    }\n  } else {\n    anchorFragments.push('bottom');\n    anchorFragments.push('left');\n  }\n\n  return anchorFragments.join('-');\n};\n\nPoiPopup.prototype.close = function () {\n  if (this.popupHandle) {\n    fire('stop_close_popup_timeout');\n    const popupWrapper = document.querySelector('.poi_popup__wrapper');\n    if (popupWrapper) {\n      ReactDOM.unmountComponentAtNode(popupWrapper);\n    }\n    this.popupHandle.remove();\n    this.popupHandle = null;\n  }\n};\n\n/* private */\nfunction isTouchEvent(event) {\n  if (event && event.originalEvent && event.originalEvent.sourceCapabilities) {\n    return event.originalEvent.sourceCapabilities.firesTouchEvents === true;\n  }\n  return false;\n}\n\nexport default PoiPopup;\n","export default class MobileCompassControl {\n  constructor() {\n    this._container = document.createElement('div');\n    const compassClass = 'map_control_group__button__compass--mobile';\n    this._compass = this._createButton(compassClass, 'Reset North', () => {\n      this._resetNorthAndTilt();\n    });\n\n    const compassIndicatorClass = 'map_control__compass__icon map_control__compass__icon--mobile';\n    this._compassIndicator = this._createIcon(compassIndicatorClass);\n    this._compass.appendChild(this._compassIndicator);\n  }\n\n  onAdd(map) {\n    this._map = map;\n    this._container.className = 'map_control_group';\n    this._container.textContent = '';\n    this._container.appendChild(this._compass);\n    const _pitchAndRotateCompassArrow = this._pitchAndRotateCompassArrow.bind(this);\n\n    _pitchAndRotateCompassArrow();\n\n    this._map.on('rotate', _pitchAndRotateCompassArrow);\n    this._map.on('pitch', _pitchAndRotateCompassArrow);\n\n    return this._container;\n  }\n\n  onRemove() {\n    this._container.parentNode.removeChild(this._container);\n    this._map = undefined;\n  }\n\n  _geolocate() {\n    navigator.geolocation.getCurrentPosition(\n      position => {\n        this._map.flyTo({ center: [position.coords.longitude, position.coords.latitude] });\n      },\n      () => undefined,\n      { maximumAge: 10000 }\n    );\n  }\n\n  _createButton(className, ariaLabel, fn) {\n    const a = document.createElement('button');\n    a.setAttribute('class', className);\n    a.setAttribute('aria-label', ariaLabel);\n    a.addEventListener('click', fn);\n    this._container.appendChild(a);\n    return a;\n  }\n\n  _createIcon(className) {\n    const a = document.createElement('span');\n    a.setAttribute('class', className);\n    return a;\n  }\n\n  _resetNorthAndTilt() {\n    this._map.easeTo({ pitch: 0, bearing: 0 });\n  }\n\n  _pitchAndRotateCompassArrow() {\n    if (this._map.getPitch() === 0 && this._map.transform.angle === 0) {\n      this._compass.classList.add('compass-origin');\n    } else {\n      this._compass.classList.remove('compass-origin');\n    }\n    const scale = 1 - this._map.getPitch() / 110;\n    const rotation = this._map.transform.angle * (180 / Math.PI);\n    this._compassIndicator.style.transform = `scale(1, ${scale}) rotate(${rotation}deg)`;\n  }\n}\n","import { ScaleControl } from 'mapbox-gl--ENV';\n\n/**\n * Override default control to pass a container\n * in constructor and register a onReady cb\n */\nexport default class ExtendedScaleControl extends ScaleControl {\n  constructor(options, container) {\n    super(options);\n    this.parentContainer = container;\n  }\n\n  onAdd(map) {\n    this._map = map;\n    this._container = document.createElement('div');\n    this._container.className = 'mapboxgl-ctrl mapboxgl-ctrl-scale map_control__scale';\n\n    this.parentContainer.appendChild(this._container);\n\n    this._map.on('move', this._onMove);\n    super._onMove();\n\n    return this.parentContainer;\n  }\n}\n","import { AttributionControl } from 'mapbox-gl--ENV';\n\n/**\n * Override default control to pass a container\n * in constructor and register a onReady cb\n */\nexport default class ExtendedAttributionControl extends AttributionControl {\n  constructor(options, container) {\n    super(options);\n    this.parentContainer = container;\n  }\n\n  onAdd(map) {\n    const container = super.onAdd(map);\n    if (container) {\n      this.parentContainer.appendChild(container);\n    }\n    return this.parentContainer;\n  }\n}\n","import ReactDOMServer from 'react-dom/server';\n\nexport default reactElement => ReactDOMServer.renderToStaticMarkup(reactElement);\n","import React from 'react';\nimport * as Geolocation from '../libs/geolocation';\nimport Telemetry from '../libs/telemetry';\nimport { openPendingGeolocateModal } from 'src/modals/GeolocationModal';\nimport * as store from 'src/adapters/store';\nimport renderStaticReact from 'src/libs/renderStaticReact';\nimport { IconGeoloc } from 'src/components/ui/icons';\nimport { isMobileDevice } from 'src/libs/device';\n\nimport { GeolocateControl } from 'mapbox-gl--ENV';\n\n/**\n * Override default GeolocateControl\n */\n\nexport default class ExtendedGeolocateControl extends GeolocateControl {\n  constructor(options, container) {\n    super(options);\n    this._container = container;\n    this.on('trackuserlocationstart', () => {\n      Telemetry.addOnce(Telemetry.LOCALISE_TRIGGER);\n    });\n  }\n\n  onAdd(map) {\n    this._map = map;\n    this._setupUI();\n    return this._container;\n  }\n\n  onReady(cb) {\n    this._onReady = cb;\n  }\n\n  async trigger() {\n    const state = await Geolocation.getGeolocationPermission();\n    if (\n      state === Geolocation.geolocationPermissions.PROMPT &&\n      !store.get('has_geolocate_modal_opened_once')\n    ) {\n      await openPendingGeolocateModal();\n      store.set('has_geolocate_modal_opened_once', true);\n    }\n    super.trigger();\n  }\n\n  _setupUI(supported) {\n    super._setupUI(supported);\n    if (this._geolocateButton?.firstChild) {\n      this._geolocateButton.firstChild.innerHTML = renderStaticReact(\n        <IconGeoloc fill=\"currentColor\" width={isMobileDevice() ? 24 : 16} />\n      );\n    }\n    this._onReady();\n  }\n\n  _onError(error) {\n    Geolocation.handleError(error);\n    super._onError(error);\n    // MapboxGL implementation disables the button after an error,\n    // but we won't the user to always have feedback with relevant links\n    // so override this behavior\n    this._geolocateButton.disabled = false;\n  }\n}\n","import React from 'react';\nimport ExtendedScaleControl from './extended_scale_control';\nimport ExtendedAttributionControl from './extended_attribution_control';\nimport GeolocControl from './extended_geolocate_control';\nimport Telemetry from 'src/libs/telemetry';\nimport { listen, unListen } from '../libs/customEvents';\nimport renderStaticReact from 'src/libs/renderStaticReact';\nimport { IconPlus, IconMinus } from 'src/components/ui/icons';\n\nexport default class ExtendedControl {\n  constructor() {\n    this._container = document.createElement('div');\n    this.topButtonGroup = document.createElement('div');\n    this.bottomButtonGroup = document.createElement('div');\n\n    // Store a callback to trigger when direction shortcut is clicked.\n    // if no callback is registered, then the default action will be executed\n    // (navigate to /routes)\n    this.directionShortcutCallback = null;\n    listen('set_direction_shortcut_callback', cb => (this.directionShortcutCallback = cb));\n\n    this._zoomInButton = this._createButton(\n      'map_control_group__button__zoom map-button--zoomIn',\n      'Zoom +',\n      () => {\n        Telemetry.add(Telemetry.MAP_ZOOM_IN);\n        this._map.zoomIn();\n      }\n    );\n    this._zoomInButton.innerHTML = renderStaticReact(<IconPlus fill=\"currentColor\" width={16} />);\n\n    this._zoomOutButton = this._createButton(\n      'map_control_group__button__zoom map-button--zoomOut',\n      'Zoom -',\n      () => {\n        Telemetry.add(Telemetry.MAP_ZOOM_OUT);\n        this._map.zoomOut();\n      }\n    );\n    this._zoomOutButton.innerHTML = renderStaticReact(<IconMinus fill=\"currentColor\" width={16} />);\n\n    const compassClass = 'map_control_group__button__compass';\n    this._compass = this._createButton(compassClass, 'Reset North', () => {\n      this._resetNorthAndTilt();\n    });\n    this._direction = this._createButton('direction_shortcut hidden', 'direction', () => {\n      Telemetry.add(Telemetry.MAP_ITINERARY);\n      this.directionShortcutCallback\n        ? this.directionShortcutCallback()\n        : window.app.navigateTo('/routes'); // default action, if no cb has been set\n    });\n\n    this._compassIndicator = this._createIcon('map_control__compass__icon');\n    this._compass.appendChild(this._compassIndicator);\n  }\n\n  onAdd(map) {\n    this._map = map;\n    this.topButtonGroup.className = 'map_control_group';\n    this.topButtonGroup.textContent = '';\n    this.bottomButtonGroup.className = 'map_control_group map_bottom_button_group mapboxgl-ctrl';\n    this.bottomButtonGroup.textContent = '';\n\n    const geolocControl = new GeolocControl(\n      {\n        positionOptions: {\n          enableHighAccuracy: true,\n        },\n        trackUserLocation: true,\n        showAccuracyCircle: false,\n      },\n      this.bottomButtonGroup\n    );\n\n    this.topButtonGroup.appendChild(this._compass);\n    this.topButtonGroup.appendChild(this._direction);\n\n    geolocControl.onReady(() => {\n      this.bottomButtonGroup.appendChild(this._zoomInButton);\n      this.bottomButtonGroup.appendChild(this._zoomOutButton);\n    });\n\n    this._map.addControl(geolocControl);\n\n    const _pitchAndRotateCompassArrow = this._pitchAndRotateCompassArrow.bind(this);\n\n    _pitchAndRotateCompassArrow();\n\n    this._map.on('rotate', _pitchAndRotateCompassArrow);\n    this._map.on('pitch', _pitchAndRotateCompassArrow);\n\n    this.scaleAttributionContainer = document.createElement('div');\n    this.scaleAttributionContainer.className = 'map_control__scale_attribute_container';\n    this._container.appendChild(this.scaleAttributionContainer);\n\n    const extendedScaleControl = new ExtendedScaleControl(\n      {\n        unit: 'metric',\n      },\n      this.scaleAttributionContainer\n    );\n\n    const extendedAttributionControl = new ExtendedAttributionControl(\n      {},\n      this.scaleAttributionContainer\n    );\n    this._container.appendChild(this.topButtonGroup);\n    this._container.appendChild(this.bottomButtonGroup);\n\n    this._container.appendChild(this.scaleAttributionContainer);\n    this._map.addControl(extendedScaleControl, 'bottom-right');\n    this._map.addControl(extendedAttributionControl, 'bottom-right');\n    return this._container;\n  }\n\n  onRemove() {\n    this._container.parentNode.removeChild(this._container);\n    this._map = undefined;\n    unListen('set_direction_shortcut_callback');\n  }\n\n  _createButton(className, ariaLabel, fn) {\n    const a = document.createElement('button');\n    a.setAttribute('class', className);\n    a.setAttribute('aria-label', ariaLabel);\n    a.setAttribute('title', ariaLabel);\n    a.addEventListener('click', fn);\n    return a;\n  }\n\n  _createIcon(className) {\n    const a = document.createElement('span');\n    a.setAttribute('class', className);\n    return a;\n  }\n\n  _resetNorthAndTilt() {\n    this._map.easeTo({ pitch: 0, bearing: 0 });\n  }\n\n  _pitchAndRotateCompassArrow() {\n    if (this._map.getPitch() === 0 && this._map.transform.angle === 0) {\n      this._compass.classList.add('compass-origin');\n    } else {\n      this._compass.classList.remove('compass-origin');\n    }\n    const scale = 1 - this._map.getPitch() / 110;\n    const rotation = this._map.transform.angle * (180 / Math.PI);\n    this._compassIndicator.style.transform = `scale(1, ${scale}) rotate(${rotation}deg)`;\n  }\n}\n","import { LngLat } from 'mapbox-gl--ENV';\nimport Poi, { POI_TYPE } from './poi';\n\nexport default class MapPoi extends Poi {\n  constructor(feature) {\n    const { global_id, ['class']: className, subclass: subClassName, name } = feature.properties;\n    const ll = LngLat.convert(feature.geometry.coordinates);\n    super(global_id || feature.id, name, POI_TYPE, ll, className, subClassName);\n  }\n}\n","import nconf from '@qwant/nconf-getter';\nimport configure from '@qwant/mapbox_style_configure';\nimport URI from '@qwant/uri';\nimport qwantStyle from '@qwant/qwant-basic-gl-style/style.json';\n\nconst mapStyleConfig = nconf.get().mapStyle;\nconst baseUrl = nconf.get().system.baseUrl;\n\nfunction sceneConfig() {\n  return Object.assign(mapStyleConfig, {\n    spritesUrl: URI.toAbsoluteUrl(location.origin, baseUrl, mapStyleConfig.spritesUrl),\n    fontsUrl: URI.toAbsoluteUrl(location.origin, baseUrl, mapStyleConfig.fontsUrl),\n  });\n}\n\nexport default function getStyle() {\n  return configure(JSON.stringify(qwantStyle), sceneConfig(), window.getBaseLang().code);\n}\n","import React from 'react';\nimport { formatDistance, formatDuration } from 'src/libs/route_utils';\nimport VehicleIcon from '../VehicleIcon';\n\nconst VEHICLES = {\n  TRAIN: 'train',\n  SUBWAY: 'metro',\n  BUS_CITY: 'bus',\n  TRAM: 'tram',\n};\n\nconst PublicTransportIcon = ({ mode }) => (\n  <div className={`publicTransportLabelItem roadmapIcon roadmapIcon--${VEHICLES[mode]}`} />\n);\n\nconst PublicTransportStepIcons = ({ route }) => {\n  const nonWalkLegs = route.legs.filter(leg => leg.mode !== 'WALK');\n\n  if (nonWalkLegs.length <= 3) {\n    return (\n      <div>\n        {nonWalkLegs.map((leg, index) => (\n          <PublicTransportIcon key={index} mode={leg.mode} />\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PublicTransportIcon mode={nonWalkLegs[0].mode} />\n      <div className=\"publicTransportLabelItem roadmapIcon u-text--caption roadmapIcon--inbetween\">\n        <div>+{nonWalkLegs.length - 2}</div>\n      </div>\n      <PublicTransportIcon mode={nonWalkLegs[nonWalkLegs.length - 1].mode} />\n    </div>\n  );\n};\n\nconst RouteLabel = ({ route, vehicle, anchor }) => {\n  const isPublicTransport = vehicle === 'publicTransport';\n  return (\n    <div data-id={route.id} className={`routeLabel routeLabel--${anchor} routeLabel--${vehicle}`}>\n      {isPublicTransport ? (\n        <PublicTransportStepIcons route={route} />\n      ) : (\n        <div className=\"routeLabel-vehicleIcon\">\n          <VehicleIcon vehicle={vehicle} fill=\"currentColor\" width={24} />\n        </div>\n      )}\n      <div>\n        <div className=\"routeLabel-duration\">{formatDuration(route.duration)}</div>\n        {!isPublicTransport && (\n          <div className=\"routeLabel-distance\">{formatDistance(route.distance)}</div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default RouteLabel;\n","import Color from 'color';\nimport { GREY_GREY, GREY_SEMI_LIGHTNESS } from 'src/libs/colors';\n\nconst darkenColor = hex => Color(hex).mix(Color('black'), 0.33).hex();\nconst safeHexColor = hex => (hex.charAt(0) === '#' ? hex : `#${hex}`);\n\nexport function prepareRouteColor(feature) {\n  const lineColor = feature.properties?.lineColor;\n  return {\n    ...feature,\n    properties: {\n      ...feature.properties,\n      lineColor: lineColor ? safeHexColor(lineColor) : 'var(--grey-900)',\n      outlineColor: lineColor ? darkenColor(safeHexColor(lineColor)) : 'var(--grey-900)',\n    },\n  };\n}\n\nfunction getColorExpression(isActive, isOutline) {\n  if (isActive) {\n    return isOutline ? ['get', 'outlineColor'] : ['get', 'lineColor'];\n  }\n  return isOutline ? GREY_GREY : GREY_SEMI_LIGHTNESS;\n}\n\nexport function getRouteStyle(vehicle, isActive, isOutline) {\n  if (vehicle === 'walking') {\n    return {\n      type: 'symbol',\n      layout: {\n        'icon-image': isActive ? 'walking_bullet_active' : 'walking_bullet_inactive',\n        'symbol-placement': 'line',\n        'symbol-spacing': 12,\n        'icon-ignore-placement': true,\n        'icon-allow-overlap': true,\n        'symbol-avoid-edges': true,\n      },\n    };\n  }\n\n  return {\n    type: 'line',\n    layout: {\n      'line-join': 'round',\n      'line-cap': 'round',\n      visibility: 'visible',\n    },\n    paint: {\n      'line-color': getColorExpression(isActive, isOutline),\n      'line-color-transition': { duration: 0 },\n      'line-width': isOutline ? 7 : 5,\n    },\n  };\n}\n\nexport function setActiveRouteStyle(map, layerId, vehicle, isActive, isOutline) {\n  if (vehicle === 'walking') {\n    map.setLayoutProperty(\n      layerId,\n      'icon-image',\n      isActive ? 'walking_bullet_active' : 'walking_bullet_inactive'\n    );\n  } else {\n    map.setPaintProperty(layerId, 'line-color', getColorExpression(isActive, isOutline));\n  }\n}\n","import React from 'react';\nimport RouteLabel from 'src/panel/direction/RouteLabel';\nimport { Marker, LngLatBounds } from 'mapbox-gl--ENV';\nimport bbox from '@turf/bbox';\nimport { normalizeToFeatureCollection } from 'src/libs/geojson';\nimport { map } from '../../config/constants.yml';\nimport LatLonPoi from '../adapters/poi/latlon_poi';\nimport { prepareRouteColor, getRouteStyle, setActiveRouteStyle } from './route_styles';\nimport { getAllSteps, getAllStops, originDestinationCoords } from 'src/libs/route_utils';\nimport Error from '../adapters/error';\nimport nconf from '@qwant/nconf-getter';\nimport { fire, listen } from 'src/libs/customEvents';\nimport { getLabelPositions } from 'alt-route-labeller';\nimport { isMobileDevice } from 'src/libs/device';\nimport renderStaticReact from 'src/libs/renderStaticReact';\n\nconst createMarker = (lngLat, className = '', options = {}) => {\n  const element = document.createElement('div');\n  element.className = className;\n  return new Marker({ ...options, element }).setLngLat(lngLat);\n};\n\nconst createRouteLabel = (route, vehicle, { lngLat, anchor }) => {\n  const element = document.createElement('div');\n  element.innerHTML = renderStaticReact(\n    <RouteLabel route={route} vehicle={vehicle} anchor={anchor} />\n  );\n  element.className = 'routeLabel-marker';\n  element.onclick = () => {\n    fire('select_road_map', route.id);\n  };\n  return new Marker({ element, anchor }).setLngLat(lngLat);\n};\n\nconst getLabelsBbbox = (labelPositions, routesBbox) => {\n  const smallScreen = isMobileDevice();\n  const shift = {\n    latShift: (routesBbox.getNorth() - routesBbox.getSouth()) / (smallScreen ? 5 : 10),\n    lngShift: (routesBbox.getEast() - routesBbox.getWest()) / (smallScreen ? 3 : 10),\n  };\n  const labelsBbbox = new LngLatBounds();\n  labelPositions.map(shiftLabelPosition(shift)).forEach(labelPosition => {\n    labelsBbbox.extend(labelPosition);\n  });\n  return labelsBbbox;\n};\n\nconst shiftLabelPosition =\n  ({ lngShift, latShift }) =>\n  ({ lngLat, anchor }) => {\n    let [lng, lat] = lngLat;\n    if (anchor === 'top') {\n      lat -= latShift;\n    } else if (anchor === 'bottom') {\n      lat += latShift;\n    } else if (anchor === 'left') {\n      lng += lngShift;\n    } else if (anchor === 'right') {\n      lng -= lngShift;\n    }\n    return [lng, lat];\n  };\n\nexport default class SceneDirection {\n  constructor(map) {\n    this.map = map;\n    this.routes = [];\n    this.routeMarkers = [];\n    this.routeLabels = [];\n    this.fullBbox = null;\n    this.mapFeaturesByRoute = {};\n\n    const iconsBaseUrl = nconf.get().system.baseUrl + 'statics/images/direction_icons';\n    this.addMapImage(`${iconsBaseUrl}/walking_bullet_active.png`, 'walking_bullet_active', {\n      pixelRatio: 4,\n    });\n    this.addMapImage(`${iconsBaseUrl}/walking_bullet_inactive.png`, 'walking_bullet_inactive', {\n      pixelRatio: 4,\n    });\n\n    listen('set_routes', ({ routes, vehicle, activeRouteId = 0 }) => {\n      this.reset();\n      this.routes = routes;\n      this.vehicle = vehicle;\n      this.displayRoutes(activeRouteId);\n    });\n\n    listen('set_main_route', ({ routeId, fitView }) => {\n      this.setMainRoute(routeId, fitView);\n    });\n\n    listen('clean_routes', () => {\n      this.reset();\n    });\n\n    listen('zoom_step', step => {\n      fire('fit_map', this.computeBBox(step));\n    });\n\n    listen('highlight_step', step => {\n      this.highlightStep(step);\n    });\n\n    listen('unhighlight_step', step => {\n      this.unhighlightStep(step);\n    });\n\n    listen('set_origin', poi => {\n      this.setOrigin(poi);\n    });\n\n    listen('set_destination', poi => {\n      this.setDestination(poi);\n    });\n  }\n\n  setOrigin = poi => {\n    const originMarker = createMarker(poi.latLon, 'itinerary_marker_origin', {\n      draggable: !isMobileDevice(),\n    })\n      .addTo(this.map)\n      .on('dragend', event => {\n        this.refreshDirection('origin', event.target.getLngLat());\n      });\n    this.routeMarkers.push(originMarker);\n  };\n\n  setDestination = poi => {\n    const destinationMarker = createMarker(poi.latLon, 'itinerary_marker_destination', {\n      draggable: !isMobileDevice(),\n      anchor: 'bottom',\n    })\n      .addTo(this.map)\n      .on('dragend', event => {\n        this.refreshDirection('destination', event.target.getLngLat());\n      });\n    this.routeMarkers.push(destinationMarker);\n  };\n\n  addMarkerSteps(route) {\n    if (this.vehicle !== 'walking' && this.vehicle !== 'publicTransport') {\n      getAllSteps(route).forEach((step, idx) => {\n        const stepMarker = createMarker(step.maneuver.location, 'itinerary_marker_step');\n        stepMarker.getElement().id = 'itinerary_marker_step_' + idx;\n        this.routeMarkers.push(stepMarker.addTo(this.map));\n      });\n    }\n\n    if (this.vehicle === 'publicTransport') {\n      getAllStops(route).forEach((stop, idx) => {\n        const stopMarker = createMarker(stop.location, 'itinerary_marker_step');\n        stopMarker.getElement().id = 'itinerary_marker_stop_' + idx;\n        stopMarker.getElement().title = stop.name;\n        this.routeMarkers.push(stopMarker.addTo(this.map));\n      });\n    }\n  }\n\n  setMainRoute(routeId, fitView) {\n    let mainRoute = null;\n    if (this.routes.length === 0) {\n      return;\n    }\n\n    this.routes.forEach(route => {\n      const isActive = route.id === routeId;\n      if (isActive) {\n        mainRoute = route;\n      }\n      this.mapFeaturesByRoute[route.id].forEach(({ layerId, outlineLayerId, vehicle }) => {\n        setActiveRouteStyle(this.map, layerId, vehicle, isActive, false);\n        if (outlineLayerId) {\n          setActiveRouteStyle(this.map, outlineLayerId, vehicle, isActive, true);\n        }\n        if (isActive) {\n          if (outlineLayerId) {\n            this.map.moveLayer(outlineLayerId, map.routes_layer);\n          }\n          this.map.moveLayer(layerId, map.routes_layer);\n        }\n      });\n    });\n    this.updateMarkers(mainRoute);\n    this.updateRouteLabels(mainRoute);\n    if (fitView && this.fullBbox) {\n      fire('fit_map', this.fullBbox);\n    }\n  }\n\n  updateMarkers(mainRoute) {\n    if (!mainRoute) {\n      return;\n    }\n\n    this.routeMarkers.forEach(marker => {\n      marker.remove();\n    });\n    this.routeMarkers = [];\n\n    this.addMarkerSteps(mainRoute);\n    const { origin, destination } = originDestinationCoords(mainRoute);\n\n    this.setOrigin({ latLon: { lng: origin[0], lat: origin[1] } });\n\n    this.setDestination({ latLon: { lng: destination[0], lat: destination[1] } });\n  }\n\n  displayRoutes(activeRouteId) {\n    if (this.routes && this.routes.length > 0) {\n      // route lines\n      this.mapFeaturesByRoute = {};\n      this.routes.forEach(route => {\n        this.mapFeaturesByRoute[route.id] = this.addRouteFeatures(\n          route,\n          route.id === activeRouteId\n        );\n      });\n      // route labels\n      const labelPositions = getLabelPositions(this.routes.map(route => route.geometry));\n      this.routeLabels = labelPositions.map(({ lngLat, anchor }, index) =>\n        createRouteLabel(this.routes[index], this.vehicle, { lngLat, anchor }).addTo(this.map)\n      );\n      // compute and store the best bbox\n      const routesBbox = new LngLatBounds();\n      this.routes.forEach(route => {\n        routesBbox.extend(this.computeBBox(route));\n      });\n      this.fullBbox = routesBbox.extend(getLabelsBbbox(labelPositions, routesBbox));\n\n      this.setMainRoute(activeRouteId, true);\n    }\n  }\n\n  updateRouteLabels({ id: activeRouteId }) {\n    // @IE11: array spread to convert NodeList to an array\n    [...document.querySelectorAll('.routeLabel')].forEach(routeLabel => {\n      if (routeLabel.dataset.id === activeRouteId.toString()) {\n        routeLabel.classList.add('active');\n      } else {\n        routeLabel.classList.remove('active');\n      }\n    });\n  }\n\n  refreshDirection(type, lngLat) {\n    const newPoint = new LatLonPoi(lngLat);\n    fire('change_direction_point', type, '', newPoint);\n  }\n\n  reset() {\n    this.routes.forEach(route => {\n      this.mapFeaturesByRoute[route.id].forEach(({ outlineLayerId, layerId, sourceId }) => {\n        if (outlineLayerId) {\n          this.map.removeLayer(outlineLayerId);\n        }\n        this.map.removeLayer(layerId);\n        this.map.removeSource(sourceId);\n      });\n    });\n    this.routes = [];\n\n    this.routeMarkers.concat(this.routeLabels).forEach(marker => {\n      marker.remove();\n    });\n    this.routeMarkers = [];\n    this.routeLabels = [];\n    this.fullBbox = null;\n  }\n\n  getDataSources(route) {\n    const featureCollection = normalizeToFeatureCollection(route.geometry);\n    const sources = [];\n    const walkFeatures = [],\n      nonWalkFeatures = [];\n    featureCollection.features.forEach(feature => {\n      if (\n        this.vehicle === 'walking' ||\n        (this.vehicle === 'publicTransport' && feature.properties.mode === 'WALK')\n      ) {\n        walkFeatures.push(feature);\n      } else {\n        nonWalkFeatures.push(prepareRouteColor(feature));\n      }\n    });\n\n    if (walkFeatures.length > 0) {\n      sources.push({\n        vehicle: 'walking',\n        data: { type: 'FeatureCollection', features: walkFeatures },\n      });\n    }\n\n    if (nonWalkFeatures.length > 0) {\n      sources.push({\n        vehicle: this.vehicle,\n        data: { type: 'FeatureCollection', features: nonWalkFeatures },\n      });\n    }\n\n    return sources;\n  }\n\n  addRouteFeatures(route, isActive) {\n    const sources = this.getDataSources(route);\n    return sources.map((source, idx) => {\n      const sourceId = `source_${route.id}_${idx}`;\n      this.map.addSource(sourceId, { type: 'geojson', data: source.data });\n\n      const layerId = `route_${route.id}_${idx}`;\n      const layerStyle = {\n        ...getRouteStyle(source.vehicle, isActive, false),\n        id: layerId,\n        source: sourceId,\n      };\n\n      let outlineLayerId;\n      if (source.vehicle !== 'walking') {\n        outlineLayerId = layerId + '_outline';\n        const outlineLayerStyle = {\n          ...getRouteStyle(source.vehicle, isActive, true),\n          id: layerId + '_outline',\n          source: sourceId,\n        };\n        this.map.addLayer(outlineLayerStyle, map.routes_layer);\n      }\n\n      this.map\n        .addLayer(layerStyle, map.routes_layer)\n        .on('click', layerId, () => {\n          fire('select_road_map', route.id);\n        })\n        .on('mouseenter', layerId, () => {\n          this.map.getCanvas().style.cursor = 'pointer';\n        })\n        .on('mouseleave', layerId, () => {\n          this.map.getCanvas().style.cursor = '';\n        });\n\n      return { sourceId, layerId, outlineLayerId, vehicle: source.vehicle };\n    });\n  }\n\n  computeBBox({ geometry }) {\n    const [minX, minY, maxX, maxY] = bbox(geometry);\n    return new LngLatBounds([minX, minY], [maxX, maxY]);\n  }\n\n  highlightStep(step) {\n    const marker = document.querySelector('#itinerary_marker_step_' + step);\n    if (marker) {\n      marker.classList.add('itinerary_marker_step--highlighted');\n    }\n  }\n\n  unhighlightStep(step) {\n    const marker = document.querySelector('#itinerary_marker_step_' + step);\n    if (marker) {\n      marker.classList.remove('itinerary_marker_step--highlighted');\n    }\n  }\n\n  addMapImage(url, name, options = {}) {\n    this.map.loadImage(url, (error, image) => {\n      if (error) {\n        Error.sendOnce('scene', 'initMapBox', `Failed to load image at ${url}`, error);\n        return;\n      }\n      this.map.addImage(name, image, options);\n    });\n  }\n}\n","import { ACTION_BLUE_BASE, RED_DARKER, GREY_BLACK } from 'src/libs/colors';\n\nexport const getFilteredPoisPinStyle = () => ({\n  type: 'symbol',\n  layout: {\n    'icon-image': ['concat', 'pin-', ['get', 'iconName']],\n    'icon-allow-overlap': true,\n    'icon-ignore-placement': false,\n    'icon-padding': 0,\n    'icon-anchor': 'bottom',\n  },\n  paint: {\n    'icon-opacity': [\n      'case',\n      ['==', ['feature-state', 'selected'], true],\n      0,\n      ['==', ['feature-state', 'hovered'], true],\n      0,\n      1,\n    ],\n  },\n});\n\nexport const getFilteredPoisLabelStyle = () => ({\n  type: 'symbol',\n  layout: {\n    'text-font': ['Noto Sans Bold'],\n    'text-size': 10,\n    'text-field': ['get', 'name'],\n    'text-allow-overlap': false,\n    'text-ignore-placement': false,\n    'text-optional': true,\n    'text-variable-anchor': ['top', 'bottom-left', 'bottom-right'],\n    'text-offset': [1.5, 0.5],\n    'text-justify': 'auto',\n  },\n  paint: {\n    'text-color': ['case', ['==', ['feature-state', 'selected'], true], RED_DARKER, GREY_BLACK],\n    'text-halo-color': 'white',\n    'text-halo-width': 1,\n    'text-translate': [0, -2],\n  },\n});\n\nexport const setPoiHoverStyle = (map, poiLayer) => {\n  if (!map.getPaintProperty) {\n    // @MAPBOX: This method isn't implemented by the Mapbox-GL mock\n    return;\n  }\n  const textColorProperty = map.getPaintProperty(poiLayer, 'text-color');\n  map.setPaintProperty(\n    poiLayer,\n    'text-color',\n    ['case', ['to-boolean', ['feature-state', 'hover']], ACTION_BLUE_BASE, textColorProperty],\n    { validate: false }\n  );\n};\n","import nconf from '@qwant/nconf-getter';\nimport { Marker } from 'mapbox-gl--ENV';\nimport constants from '../../config/constants.yml';\nimport Telemetry from 'src/libs/telemetry';\nimport { toUrl } from 'src/libs/pois';\nimport { fire, listen } from 'src/libs/customEvents';\nimport { poiToGeoJSON, emptyFeatureCollection } from 'src/libs/geojson';\nimport { getFilteredPoisPinStyle, getFilteredPoisLabelStyle } from 'src/adapters/pois_styles';\nimport { isMobileDevice } from 'src/libs/device';\nimport { createMapGLIcon, createPinIcon } from 'src/adapters/icon_manager';\nimport IconManager from 'src/adapters/icon_manager';\n\nconst mapStyleConfig = nconf.get().mapStyle;\n\nconst poisToGeoJSON = pois => {\n  return {\n    type: 'FeatureCollection',\n    features: pois.map(poi => {\n      const poiFeature = poiToGeoJSON(poi);\n      poiFeature.properties.iconName = IconManager.get(poi).iconClass;\n      return poiFeature;\n    }),\n  };\n};\n\nexport default class SceneCategory {\n  constructor(map) {\n    this.map = map;\n    this.sourceName = 'poi-filtered';\n    this.layers = [];\n\n    this.initActiveStateMarkers();\n    this.initDynamicPoiLayers();\n\n    listen('add_category_markers', this.addCategoryMarkers);\n    listen('remove_category_markers', this.removeCategoryMarkers);\n    listen('highlight_category_marker', this.highlightPoiMarker);\n    listen('click_category_marker', this.selectPoiMarker);\n    listen('click_category_poi', this.selectPoi);\n    listen('clean_marker', () => this.selectPoiMarker(null));\n  }\n\n  initActiveStateMarkers = () => {\n    this.hoveredPoi = null;\n    this.hoveredMarker = new Marker({\n      element: createPinIcon({ disablePointerEvents: true, className: 'marker--category' }),\n      anchor: 'bottom',\n    });\n    this.selectedPoi = null;\n    this.selectedMarker = new Marker({\n      element: createPinIcon({ className: 'marker--category' }),\n      anchor: 'bottom',\n    });\n  };\n\n  initDynamicPoiLayers = () => {\n    // Declare a new image in MapBox-GL rasters so it can be used in the layer style\n    createMapGLIcon('./statics/images/map/pin_map_dot.svg', 50, 60).then(imageData => {\n      this.map.addImage('pin_with_dot', imageData);\n    });\n\n    this.map.addSource(this.sourceName, {\n      type: 'geojson',\n      data: emptyFeatureCollection,\n      // tells MapBox-GL to use this property as internal feature identifier\n      promoteId: 'id',\n    });\n\n    if (mapStyleConfig.showNamesWithPins) {\n      const labelLayerId = `${this.sourceName}_labels`;\n      this.map.addLayer({\n        ...getFilteredPoisLabelStyle(),\n        source: this.sourceName,\n        id: labelLayerId,\n      });\n      this.layers.push(labelLayerId);\n    }\n\n    const pinLayerId = `${this.sourceName}_pins`;\n    this.map.addLayer({\n      ...getFilteredPoisPinStyle(),\n      source: this.sourceName,\n      id: pinLayerId,\n    });\n    this.layers.push(pinLayerId);\n\n    this.layers.forEach(layerName => {\n      this.map.on('click', layerName, this.handleLayerMarkerClick);\n      if (!isMobileDevice()) {\n        this.map.on('mouseover', layerName, this.handleLayerMarkerMouseOver);\n        this.map.on('mouseleave', layerName, this.handleLayerMarkerMouseLeave);\n      }\n    });\n  };\n\n  getPointedPoi = mapMouseEvent => {\n    const feature = mapMouseEvent.features[0];\n    return feature && this.pois.find(p => p.id === feature.id);\n  };\n\n  selectPoi = ({ poi, poiFilters, pois }) => {\n    if (poi.meta && poi.meta.source) {\n      Telemetry.sendPoiEvent(\n        poi,\n        'open',\n        Telemetry.buildInteractionData({\n          id: poi.id,\n          source: poi.meta.source,\n          template: 'multiple',\n          zone: 'list',\n          element: 'item',\n          category: poiFilters.category,\n        })\n      );\n    }\n    window.app.navigateTo(`/place/${toUrl(poi)}`, {\n      poi,\n      poiFilters,\n      pois,\n      centerMap: true,\n    });\n    this.selectPoiMarker(poi);\n  };\n\n  handleLayerMarkerClick = e => {\n    e.originalEvent.stopPropagation();\n    const poi = this.getPointedPoi(e);\n\n    this.selectPoi({\n      poi,\n      pois: this.pois,\n      poiFilters: this.poiFilters,\n    });\n  };\n\n  handleLayerMarkerMouseOver = e => {\n    this.map.getCanvas().style.cursor = 'pointer';\n    const poi = this.getPointedPoi(e);\n    if (this.selectedPoi?.id !== poi.id) {\n      this.highlightPoiMarker(poi, true);\n      fire('open_popup', poi, e.originalEvent);\n    }\n  };\n\n  handleLayerMarkerMouseLeave = () => {\n    this.map.getCanvas().style.cursor = '';\n    this.highlightPoiMarker(this.hoveredPoi, false);\n    // delay the popup closure so it can be hovered\n    fire('start_close_popup_timeout');\n  };\n\n  addCategoryMarkers = (pois = [], poiFilters) => {\n    fire('close_popup');\n    this.pois = pois;\n    this.poiFilters = poiFilters;\n    this.setOsmPoisVisibility(false);\n    this.map.getSource(this.sourceName).setData(poisToGeoJSON(pois));\n    this.layers.forEach(layerName => {\n      this.map.setLayoutProperty(layerName, 'visibility', 'visible');\n    });\n  };\n\n  removeCategoryMarkers = () => {\n    fire('close_popup');\n    this.selectPoiMarker(null);\n    this.highlightPoiMarker(this.hoveredPoi, false);\n    this.layers.forEach(layerName => {\n      this.map.setLayoutProperty(layerName, 'visibility', 'none');\n    });\n    this.setOsmPoisVisibility(true);\n  };\n\n  setOsmPoisVisibility = displayed => {\n    constants.map.pois_layers.map(poi => {\n      this.map.setLayoutProperty(poi, 'visibility', displayed ? 'visible' : 'none');\n    });\n  };\n\n  setPoiFeatureState = (id, state) => {\n    this.map.setFeatureState({ id, source: this.sourceName }, state);\n  };\n\n  highlightPoiMarker = (poi, highlight) => {\n    if (this.hoveredPoi) {\n      this.setPoiFeatureState(this.hoveredPoi.id, { hovered: false });\n    }\n    if (highlight) {\n      this.hoveredPoi = poi;\n      this.hoveredMarker.setLngLat(poi.latLon).addTo(this.map);\n      this.setPoiFeatureState(this.hoveredPoi.id, { hovered: true });\n    } else {\n      this.hoveredMarker.remove();\n      this.hoveredPoi = null;\n    }\n  };\n\n  selectPoiMarker = poi => {\n    if (this.selectedPoi === poi) {\n      return;\n    }\n    if (this.selectedPoi) {\n      this.setPoiFeatureState(this.selectedPoi.id, { selected: false });\n    }\n    if (poi) {\n      this.selectedPoi = poi;\n      this.selectedMarker.setLngLat(poi.latLon).addTo(this.map);\n      this.setPoiFeatureState(this.selectedPoi.id, { selected: true });\n    } else {\n      this.selectedMarker.remove();\n      this.selectedPoi = null;\n    }\n  };\n}\n","/* global _ */\n\nconst defaultLocale = {\n  'GeolocateControl.FindMyLocation': _('My location', 'mapbox'),\n};\n\nexport default defaultLocale;\n","import { Map, Marker, LngLat, setRTLTextPlugin, LngLatBounds } from 'mapbox-gl--ENV';\nimport PoiPopup from './poi_popup';\nimport MobileCompassControl from '../mapbox/mobile_compass_control';\nimport ExtendedControl from '../mapbox/extended_nav_control';\nimport { map as mapConfig } from 'config/constants.yml';\nimport { getCurrentMapPaddings, isPositionUnderUI } from 'src/panel/layouts';\nimport nconf from '@qwant/nconf-getter';\nimport MapPoi from './poi/map_poi';\nimport { getLastLocation, setLastLocation } from 'src/adapters/store';\nimport getStyle from './scene_config';\nimport SceneDirection from './scene_direction';\nimport SceneCategory from './scene_category';\nimport { createDefaultPin } from '../adapters/icon_manager';\nimport LatLonPoi from './poi/latlon_poi';\nimport { isMobileDevice } from 'src/libs/device';\nimport { parseMapHash, getMapHash } from 'src/libs/url_utils';\nimport { parseBboxString } from 'src/libs/bounds';\nimport { toUrl, getBestZoom } from 'src/libs/pois';\nimport Error from 'src/adapters/error';\nimport { fire, listen } from 'src/libs/customEvents';\nimport locale from '../mapbox/locale';\nimport { setPoiHoverStyle } from 'src/adapters/pois_styles';\n\nconst baseUrl = nconf.get().system.baseUrl;\nconst LONG_TOUCH_DELAY_MS = 500;\nconst MOBILE_IDLE_DELAY_MS = 2000;\nlet MOBILE_IDLE_TIMEOUT;\n\nfunction Scene() {\n  this.currentMarker = null;\n  this.popup = new PoiPopup();\n  this.savedLocation = null;\n}\n\nconst getPoiView = poi => ({\n  center: poi.geometry.center,\n  zoom: getBestZoom(poi),\n  bounds: poi.geometry.bbox,\n});\n\nconst hideMobileScale = function () {\n  const item = document.querySelector('.map_control__scale');\n  if (item) {\n    item.classList.add('fadeOut');\n  }\n};\n\nconst showMobileScale = function () {\n  const item = document.querySelector('.map_control__scale');\n  if (item) {\n    item.classList.remove('fadeOut');\n  }\n};\n\nScene.prototype.getMapInitOptions = function ({ locationHash, bbox }) {\n  if (bbox) {\n    try {\n      return { bounds: parseBboxString(bbox) };\n    } catch (e) {\n      console.error(e);\n    }\n  }\n  if (window.hotLoadPoi) {\n    return getPoiView(window.hotLoadPoi);\n  }\n  if (locationHash) {\n    return {\n      zoom: locationHash.zoom,\n      center: [locationHash.lng, locationHash.lat],\n    };\n  }\n  const lastLocation = getLastLocation();\n  if (lastLocation) {\n    return {\n      zoom: lastLocation.zoom,\n      center: [lastLocation.lng, lastLocation.lat],\n    };\n  }\n  if (window.initialBbox) {\n    return {\n      bounds: window.initialBbox,\n      fitBoundsOptions: {\n        maxZoom: 9,\n      },\n    };\n  }\n  return {\n    zoom: mapConfig.zoom,\n    center: [mapConfig.center.lng, mapConfig.center.lat],\n  };\n};\n\nScene.prototype.initMapBox = function ({ locationHash, bbox }) {\n  window.times.initMapBox = Date.now();\n  const compilationHash = window.__config.compilationHash;\n  setRTLTextPlugin(\n    `${baseUrl}statics/build/javascript/map_plugins/mapbox-gl-rtl-text-${compilationHash}.js`,\n    error => {\n      if (error) {\n        Error.send('scene', 'setRTLTextPlugin', 'Failed to load mapbox RTL plugin', error);\n      }\n    },\n    /* lazy */ true\n  );\n\n  this.mb = new Map({\n    attributionControl: false,\n    container: 'scene_container',\n    style: getStyle(),\n    hash: false,\n    maxZoom: 20,\n    locale,\n    ...this.getMapInitOptions({ locationHash, bbox }),\n  });\n  // @MAPBOX: This method isn't implemented by the Mapbox-GL mock\n  this.mb.setPadding = this.mb.setPadding || (() => undefined);\n  this.mb.setPadding(getCurrentMapPaddings());\n\n  this.popup.init(this.mb);\n  window.map = this;\n\n  const interactiveLayers = [\n    'poi-level-1',\n    'poi-level-2',\n    'poi-level-3',\n    'poi-level-public-transports-1',\n    'poi-level-public-transports-2',\n  ];\n  this.hoveredPoi = null;\n\n  // Max time between two touch to be considered a single \"double click\" event\n  // This is the value Mapbox-GL uses, in src/ui/handler/dblclick_zoom.js\n  this.DOUBLE_TAP_DELAY_MS = 300;\n  this.lastDoubleTapTimeStamp = 0;\n  this.lastTouchEndTimeStamp = 0;\n  this.mb.on('touchend', () => {\n    const timeStamp = Date.now();\n    // maybe we should also check the distance between the two touch events\n    if (timeStamp - this.lastTouchEndTimeStamp < this.DOUBLE_TAP_DELAY_MS) {\n      this.lastDoubleTapTimeStamp = timeStamp;\n    }\n    this.lastTouchEndTimeStamp = timeStamp;\n  });\n\n  this.mb.on('load', () => {\n    fire('restart_idle_timeout');\n    this.onHashChange();\n    new SceneDirection(this.mb);\n    new SceneCategory(this.mb);\n\n    this.mb.addControl(new ExtendedControl(), 'bottom-right');\n    this.mb.addControl(new MobileCompassControl(), 'top-right');\n\n    if (!isMobileDevice()) {\n      interactiveLayers.forEach(interactiveLayer => {\n        setPoiHoverStyle(this.mb, interactiveLayer);\n\n        this.mb.on('mouseenter', interactiveLayer, e => {\n          if (e.features.length > 0) {\n            this.hoveredPoi = e.features[0];\n            this.mb.setFeatureState(this.hoveredPoi, { hover: true });\n          }\n          this.mb.getCanvas().style.cursor = 'pointer';\n        });\n\n        this.mb.on('mouseleave', interactiveLayer, () => {\n          if (this.hoveredPoi) {\n            this.mb.setFeatureState(this.hoveredPoi, { hover: false });\n            this.hoveredPoi = null;\n          }\n          this.mb.getCanvas().style.cursor = '';\n        });\n\n        this.popup.addListener(interactiveLayer);\n      });\n    }\n\n    // we have to delay click event resolution to make time for possible double click events,\n    // which are thrown *after* two separate click events are thrown\n    this.clickDelayHandler = null;\n\n    this.mb.on('click', e => {\n      fire('restart_idle_timeout');\n      if (e.originalEvent.cancelBubble) {\n        return;\n      }\n      // cancel the previous click handler if it's still pending\n      clearTimeout(this.clickDelayHandler);\n      // if this is a real mouse double-click, we can simply return here\n      if (e.originalEvent.detail >= 2) {\n        return;\n      }\n      const pois = this.mb.queryRenderedFeatures(e.point, { layers: interactiveLayers });\n      // when clicking on a POI, just trigger the action without delay,\n      // as a subsequent double click isn't a problem\n      if (pois[0]) {\n        this.clickOnMap(e.lngLat, pois[0]);\n        return;\n      }\n      this.clickDelayHandler = setTimeout(() => {\n        // for touch UX we have to make sure a double tap zoom hasn't been made in the meantime\n        if (Date.now() - this.lastDoubleTapTimeStamp < this.DOUBLE_TAP_DELAY_MS) {\n          return;\n        }\n        this.clickOnMap(e.lngLat, null);\n      }, this.DOUBLE_TAP_DELAY_MS);\n    });\n\n    // Long touch polyfill (for mobile devices and touch screens)\n    // Custom implementation because the contextmenu event isn't supported by MapBox.\n    // Long touch is initiated on touchstart event, and canceled if a move, gesture or touchend occurs before 500ms.\n    // Sources:\n    // https://stackoverflow.com/a/1943768 (explanation of 500ms delay)\n    // https://stackoverflow.com/a/54746189 (polyfill implementation also using the 500ms delay)\n\n    let longTouchTimeout = null;\n    this.mb.on('touchstart', e => {\n      fire('restart_idle_timeout');\n      if (e.originalEvent.touches.length === 1) {\n        longTouchTimeout = setTimeout(() => {\n          this.clickOnMap(e.lngLat, null, { longTouch: true });\n          this.cancelClickAfterLongTouch = true;\n        }, LONG_TOUCH_DELAY_MS);\n      }\n    });\n\n    const longTouchCancellingEvents = [\n      'touchend',\n      // 'touchcancel', // ignore this event as it's always thrown by Firefox Android\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=1481923\n      // Doesn't seem to change the behavior for other browsers\n      'touchmove',\n      'pointerdrag',\n      'pointermove',\n      'moveend',\n      'gesturestart',\n      'gesturechange',\n      'gestureend',\n    ];\n\n    const cancelLongTouch = e => {\n      if (longTouchTimeout) {\n        clearTimeout(longTouchTimeout);\n        longTouchTimeout = null;\n      }\n\n      if (this.cancelClickAfterLongTouch) {\n        e.originalEvent.preventDefault();\n        this.cancelClickAfterLongTouch = false;\n      }\n    };\n\n    longTouchCancellingEvents.forEach(event => {\n      this.mb.on(event, cancelLongTouch);\n    });\n\n    this.mb.on('dragstart', () => {\n      fire('map_user_interaction');\n    });\n    this.mb.on('pitchstart', () => {\n      fire('map_user_interaction');\n    });\n\n    this.mb.on('moveend', () => {\n      const { lng, lat } = this.mb.getCenter();\n      const zoom = this.mb.getZoom();\n      setLastLocation({ lng, lat, zoom });\n      window.app.updateHash(this.getLocationHash());\n      fire('map_moveend');\n    });\n\n    window.execOnMapLoaded = f => f();\n    fire('map_loaded');\n  });\n\n  listen('fit_map', (item, forceAnimate) => {\n    this.fitMap(item, forceAnimate);\n  });\n\n  listen('ensure_poi_visible', (poi, options) => {\n    this.ensureMarkerIsVisible(poi, options);\n  });\n\n  listen('create_poi_marker', poi => {\n    this.addMarker(poi);\n  });\n\n  listen('clean_marker', () => {\n    this.cleanMarker();\n  });\n\n  listen('save_location', () => {\n    this.saveLocation();\n  });\n\n  listen('restore_location', () => {\n    this.restoreLocation();\n  });\n\n  listen('move_mobile_bottom_ui', bottom => {\n    this.moveMobileBottomUI(bottom);\n  });\n\n  listen('move_mobile_geolocation_button', bottom => {\n    this.moveMobileGeolocationButton(bottom);\n  });\n\n  listen('mobile_geolocation_button_visibility', visible => {\n    this.mobileButtonVisibility('.mapboxgl-ctrl-geolocate', visible);\n  });\n\n  listen('mobile_direction_button_visibility', visible => {\n    this.mobileButtonVisibility('.direction_shortcut', visible);\n  });\n\n  listen('update_map_paddings', () => {\n    this.mb.setPadding(getCurrentMapPaddings());\n  });\n};\n\nScene.prototype.clickOnMap = function (lngLat, clickedFeature, { longTouch = false } = {}) {\n  // Instantiate the place clicked as a PoI\n  const poi = clickedFeature ? new MapPoi(clickedFeature) : new LatLonPoi(lngLat);\n\n  if (document.querySelector('.directions-open')) {\n    // If Direction panel is open, tell it to fill its fields with this PoI\n    fire('set_direction_point', poi);\n  } else if (isMobileDevice() && !clickedFeature && !longTouch) {\n    // On mobile, simple clicks anywhere don't do anything\n    return;\n  } else {\n    // Default case: open the POI panel\n    window.app.navigateTo(`/place/${toUrl(poi)}`, { poi });\n  }\n};\n\nScene.prototype.saveLocation = function () {\n  this.savedLocation = this.getLocationHash();\n};\n\nScene.prototype.restoreLocation = function () {\n  if (this.savedLocation) {\n    const { zoom, lat, lng } = parseMapHash(this.savedLocation);\n    const flyOptions = {\n      center: [lng, lat],\n      zoom,\n      animate: true,\n      screenSpeed: 2,\n    };\n    this.mb.flyTo(flyOptions);\n  }\n};\n\nconst clamp = (min, max, value) => Math.min(max, Math.max(min, value));\n\nScene.prototype.isBBoxInExtendedViewport = function (bbox) {\n  const viewport = this.mb.getBounds();\n\n  const width = viewport.getEast() - viewport.getWest();\n  const height = viewport.getNorth() - viewport.getSouth();\n\n  // Compute extended viewport, with lats between -85 and 85\n  viewport.setNorthEast(\n    new LngLat(viewport.getEast() + width, clamp(-85, 85, viewport.getNorth() + height)).wrap()\n  );\n  viewport.setSouthWest(\n    new LngLat(viewport.getWest() - width, clamp(-85, 85, viewport.getSouth() - height)).wrap()\n  );\n\n  // Check if the bbox overlaps the viewport\n  return (\n    viewport.contains(bbox.getNorthWest()) ||\n    viewport.contains(bbox.getNorthEast()) ||\n    viewport.contains(bbox.getSouthEast()) ||\n    viewport.contains(bbox.getSouthWest())\n  );\n};\n\nScene.prototype.fitBbox = function (bbox, forceAnimate) {\n  // normalise bbox\n  if (bbox instanceof Array) {\n    bbox = new LngLatBounds(bbox);\n  }\n\n  // Animate if the zoom is big enough and if the BBox is (partially or fully) in\n  // the extended viewport.\n  const animate = forceAnimate || (this.mb.getZoom() > 10 && this.isBBoxInExtendedViewport(bbox));\n  this.mb.fitBounds(bbox, { animate });\n};\n\n// Move the map to focus on an item\nScene.prototype.fitMap = function (item, forceAnimate) {\n  // BBox\n  if (item instanceof LngLatBounds || Array.isArray(item)) {\n    this.fitBbox(item, forceAnimate);\n  } else {\n    // PoI\n    if (item.bbox) {\n      // poi Bbox\n      this.fitBbox(item.bbox, forceAnimate);\n    } else {\n      // poi center\n      const flyOptions = {\n        center: item.latLon,\n        zoom: getBestZoom(item),\n        screenSpeed: 1.5,\n        animate: false,\n      };\n\n      if (forceAnimate || (this.mb.getZoom() > 10 && this.isWindowedPoi(item))) {\n        flyOptions.animate = true;\n      }\n      this.mb.flyTo(flyOptions);\n    }\n  }\n};\n\nScene.prototype.ensureMarkerIsVisible = function (poi, options) {\n  if (poi.bbox) {\n    this.fitBbox(poi.bbox);\n    return;\n  }\n  const isMobile = isMobileDevice();\n  if (!options.centerMap) {\n    const isPoiUnderPanel = isPositionUnderUI(this.mb.project(poi.latLon), { isMobile });\n    if (this.isWindowedPoi(poi) && !isPoiUnderPanel) {\n      return;\n    }\n  }\n  this.mb.flyTo({\n    center: poi.latLon,\n    zoom: getBestZoom(poi),\n    maxDuration: 1200,\n  });\n};\n\nScene.prototype.addMarker = function (poi) {\n  const element = createDefaultPin();\n  element.onclick = function (e) {\n    // click event should not be propagated to the map itself;\n    e.stopPropagation();\n  };\n\n  if (this.currentMarker !== null) {\n    this.currentMarker.remove();\n  }\n\n  const marker = new Marker({ element, anchor: 'bottom', offset: [0, -5] })\n    .setLngLat(poi.latLon)\n    .addTo(this.mb);\n  this.currentMarker = marker;\n  return marker;\n};\n\nScene.prototype.cleanMarker = async function () {\n  if (this.currentMarker !== null) {\n    this.currentMarker.remove();\n    this.currentMarker = null;\n  }\n};\n\nScene.prototype.isWindowedPoi = function (poi) {\n  return this.mb.getBounds().contains(new LngLat(poi.latLon.lng, poi.latLon.lat));\n};\n\nScene.prototype.getLocationHash = function () {\n  const { lat, lng } = this.mb.getCenter();\n  return getMapHash(this.mb.getZoom(), lat, lng);\n};\n\nScene.prototype.restoreFromHash = function (hash, options = {}) {\n  const zll = parseMapHash(hash);\n  if (!zll) {\n    return;\n  }\n  const { zoom, lat, lng } = zll;\n  this.mb.flyTo({ zoom, center: [lng, lat], ...options });\n};\n\nScene.prototype.onHashChange = function () {\n  window.onhashchange = () => {\n    this.restoreFromHash(window.location.hash, { animate: false });\n  };\n};\n\nScene.prototype.translateUIControl = function (selector, bottom) {\n  const item = document.querySelector(selector);\n  if (item) {\n    item.style.transform = `translateY(${-bottom}px)`;\n  }\n};\n\nScene.prototype.moveMobileBottomUI = function (bottom = 0) {\n  if (!isMobileDevice() && bottom > 0) {\n    return;\n  }\n  const uiControls = [\n    '.map_control__scale_attribute_container',\n    '.mapboxgl-ctrl-geolocate',\n    '.direction_shortcut',\n  ];\n  uiControls.forEach(uiControl => {\n    this.translateUIControl(uiControl, bottom);\n  });\n};\n\nScene.prototype.moveMobileGeolocationButton = function (bottom = 0) {\n  if (!isMobileDevice() && bottom > 0) {\n    return;\n  }\n  this.translateUIControl('.mapboxgl-ctrl-geolocate', bottom);\n};\n\nScene.prototype.mobileButtonVisibility = function (selector, visible) {\n  if (!isMobileDevice()) {\n    return;\n  }\n  const item = document.querySelector(selector);\n  if (item) {\n    if (visible) {\n      item.classList.remove('hidden');\n    } else {\n      item.classList.add('hidden');\n    }\n  }\n};\n\nlisten('restart_idle_timeout', () => {\n  // Cancel idle status\n  showMobileScale();\n  clearTimeout(MOBILE_IDLE_TIMEOUT);\n\n  // Start a new 2s idle timeout\n  MOBILE_IDLE_TIMEOUT = setTimeout(() => {\n    hideMobileScale();\n  }, MOBILE_IDLE_DELAY_MS);\n});\n\nexport default Scene;\n"],"sourceRoot":""}