{"version":3,"sources":["webpack:///./local_modules/mapbox_style_configure/index.js","webpack:///./src/adapters/poi/map_poi.js","webpack:///./src/adapters/poi_popup.js","webpack:///./src/adapters/pois_styles.js","webpack:///./src/adapters/route_styles.js","webpack:///./src/adapters/scene.js","webpack:///./src/adapters/scene_category.js","webpack:///./src/adapters/scene_config.js","webpack:///./src/adapters/scene_direction.js","webpack:///./src/components/PoiPopup.jsx","webpack:///./src/libs/renderStaticReact.js","webpack:///./src/mapbox/extended_attribution_control.js","webpack:///./src/mapbox/extended_geolocate_control.js","webpack:///./src/mapbox/extended_nav_control.js","webpack:///./src/mapbox/extended_scale_control.js","webpack:///./src/mapbox/locale.js","webpack:///./src/mapbox/mobile_compass_control.js","webpack:///./src/panel/direction/RouteLabel.jsx"],"names":["module","exports","configure","style","mapStyleConfig","lang","JSON","parse","replace","baseMapUrl","poiMapUrl","spritesUrl","fontsUrl","MapPoi","feature","properties","global_id","className","subClassName","subclass","name","ll","LngLat","convert","geometry","coordinates","id","POI_TYPE","Poi","WAIT_BEFORE_DISPLAY","WAIT_BEFORE_CLOSE","PoiPopup","undefined","prototype","init","map","popupHandle","timeOutHandler","activePoiId","closeTimeoutHandler","listen","poi","e","isMobileDevice","isTouchEvent","createPJPopup","fire","close","clearTimeout","setTimeout","addListener","layer","on","features","createOSMPopup","originalEvent","layerPoi","event","ApiPoi","poiApiLoad","simple","showPopup","popupOptions","closeButton","maxWidth","offset","anchor","getPopupAnchor","Popup","setLngLat","latLon","setHTML","addTo","popupWrapper","document","querySelector","ReactDOM","render","VERTICAL_OFFSET","HORIZONTAL_OFFSET","canvasWidth","window","innerWidth","anchorFragments","clientY","push","clientX","join","unmountComponentAtNode","remove","sourceCapabilities","firesTouchEvents","getFilteredPoisPinStyle","type","layout","paint","getFilteredPoisLabelStyle","RED_DARKER","GREY_BLACK","setPoiHoverStyle","poiLayer","getPaintProperty","textColorProperty","setPaintProperty","ACTION_BLUE_BASE","validate","darkenColor","hex","Color","mix","safeHexColor","charAt","prepareRouteColor","lineColor","ACTION_BLUE_SEMI_LIGHTNESS","outlineColor","ACTION_BLUE_DARK","getColorExpression","isActive","isOutline","GREY_GREY","GREY_SEMI_LIGHTNESS","getRouteStyle","vehicle","visibility","duration","setActiveRouteStyle","layerId","setLayoutProperty","baseUrl","nconf","get","system","LONG_TOUCH_DELAY_MS","MOBILE_IDLE_DELAY_MS","MOBILE_IDLE_TIMEOUT","Scene","currentMarker","popup","savedLocation","getPoiView","center","zoom","getBestZoom","bounds","bbox","hideMobileScale","item","classList","add","showMobileScale","getMapInitOptions","locationHash","parseBboxString","console","error","hotLoadPoi","lng","lat","lastLocation","getLastLocation","initialBbox","fitBoundsOptions","maxZoom","mapConfig","initMapBox","times","Date","now","compilationHash","__config","setRTLTextPlugin","Error","send","mb","Map","attributionControl","container","getStyle","hash","locale","setPadding","getCurrentMapPaddings","interactiveLayers","hoveredPoi","DOUBLE_TAP_DELAY_MS","lastDoubleTapTimeStamp","lastTouchEndTimeStamp","timeStamp","onHashChange","SceneDirection","SceneCategory","addControl","ExtendedControl","MobileCompassControl","forEach","interactiveLayer","length","setFeatureState","hover","getCanvas","cursor","clickDelayHandler","cancelBubble","detail","pois","queryRenderedFeatures","point","layers","clickOnMap","lngLat","longTouchTimeout","touches","longTouch","cancelClickAfterLongTouch","longTouchCancellingEvents","cancelLongTouch","preventDefault","getCenter","getZoom","setLastLocation","app","updateHash","getLocationHash","execOnMapLoaded","f","forceAnimate","fitMap","options","ensureMarkerIsVisible","addMarker","cleanMarker","saveLocation","restoreLocation","bottom","moveMobileBottomUI","moveMobileGeolocationButton","visible","mobileButtonVisibility","clickedFeature","LatLonPoi","navigateTo","toUrl","parseMapHash","flyOptions","animate","screenSpeed","flyTo","clamp","min","max","value","Math","isBBoxInExtendedViewport","viewport","getBounds","width","getEast","getWest","height","getNorth","getSouth","setNorthEast","wrap","setSouthWest","contains","getNorthWest","getNorthEast","getSouthEast","getSouthWest","fitBbox","Array","LngLatBounds","fitBounds","isArray","isWindowedPoi","isMobile","centerMap","isPoiUnderPanel","isPositionUnderUI","project","maxDuration","element","createDefaultPin","onclick","stopPropagation","marker","Marker","getMapHash","restoreFromHash","zll","onhashchange","location","translateUIControl","selector","transform","uiControls","uiControl","mapStyle","poisToGeoJSON","poiFeature","poiToGeoJSON","iconName","IconManager","iconClass","hoveredMarker","createPinIcon","disablePointerEvents","selectedPoi","selectedMarker","createMapGLIcon","then","imageData","addImage","addSource","sourceName","data","emptyFeatureCollection","promoteId","showNamesWithPins","labelLayerId","addLayer","source","pinLayerId","layerName","handleLayerMarkerClick","handleLayerMarkerMouseOver","handleLayerMarkerMouseLeave","mapMouseEvent","find","p","poiFilters","meta","Telemetry","sendPoiEvent","buildInteractionData","template","zone","category","selectPoiMarker","getPointedPoi","selectPoi","highlightPoiMarker","setOsmPoisVisibility","getSource","setData","displayed","constants","pois_layers","state","highlight","setPoiFeatureState","hovered","selected","initActiveStateMarkers","initDynamicPoiLayers","addCategoryMarkers","removeCategoryMarkers","sceneConfig","Object","assign","URI","toAbsoluteUrl","origin","stringify","qwantStyle","getBaseLang","code","createMarker","createElement","createRouteLabel","route","innerHTML","renderStaticReact","getLabelsBbbox","labelPositions","routesBbox","smallScreen","shift","latShift","lngShift","labelsBbbox","shiftLabelPosition","labelPosition","extend","originMarker","draggable","refreshDirection","target","getLngLat","routeMarkers","destinationMarker","routes","routeLabels","fullBbox","mapFeaturesByRoute","iconsBaseUrl","addMapImage","pixelRatio","activeRouteId","reset","displayRoutes","routeId","fitView","setMainRoute","step","computeBBox","highlightStep","unhighlightStep","setOrigin","setDestination","getAllSteps","idx","stepMarker","maneuver","getElement","getAllStops","stop","stopMarker","title","mainRoute","outlineLayerId","moveLayer","routes_layer","updateMarkers","updateRouteLabels","addMarkerSteps","originDestinationCoords","destination","addRouteFeatures","getLabelPositions","index","querySelectorAll","routeLabel","dataset","toString","newPoint","sourceId","removeLayer","removeSource","concat","featureCollection","normalizeToFeatureCollection","sources","walkFeatures","nonWalkFeatures","mode","getDataSources","layerStyle","outlineLayerStyle","minX","minY","maxX","maxY","url","loadImage","image","sendOnce","useFavorites","isInFavorites","removeFromFavorites","addToFavorites","isDirectionActive","useConfig","enabled","openDirection","onClickPhoneNumber","toggleStorePoi","isFavorite","stored","reactElement","ReactDOMServer","renderToStaticMarkup","ExtendedAttributionControl","parentContainer","appendChild","AttributionControl","ExtendedGeolocateControl","_container","addOnce","LOCALISE_TRIGGER","_map","_setupUI","cb","_onReady","Geolocation","PROMPT","store","openPendingGeolocateModal","supported","_geolocateButton","firstChild","disabled","GeolocateControl","topButtonGroup","bottomButtonGroup","directionShortcutCallback","_zoomInButton","_createButton","MAP_ZOOM_IN","zoomIn","_zoomOutButton","MAP_ZOOM_OUT","zoomOut","compassClass","_compass","_resetNorthAndTilt","_direction","MAP_ITINERARY","_compassIndicator","_createIcon","textContent","geolocControl","GeolocControl","positionOptions","enableHighAccuracy","trackUserLocation","showAccuracyCircle","onReady","_pitchAndRotateCompassArrow","bind","scaleAttributionContainer","extendedScaleControl","ExtendedScaleControl","unit","extendedAttributionControl","parentNode","removeChild","unListen","ariaLabel","fn","a","setAttribute","addEventListener","easeTo","pitch","bearing","getPitch","angle","scale","rotation","PI","_onMove","ScaleControl","defaultLocale","_","compassIndicatorClass","navigator","geolocation","getCurrentPosition","position","coords","longitude","latitude","maximumAge","VEHICLES","TRAIN","SUBWAY","BUS_CITY","TRAM","PublicTransportIcon","PublicTransportStepIcons","nonWalkLegs","legs","filter","leg","RouteLabel","isPublicTransport","formatDuration","formatDistance","distance"],"mappings":"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","file":"map-6a915ed20e2690ae1c9b.bundle.js","sourcesContent":["module.exports = function configure(style, mapStyleConfig, lang) {\n  return JSON.parse(style\n    .replace(/\\{locale\\}/g, lang)\n    .replace('\"{tileserver_base}\"', mapStyleConfig.baseMapUrl)\n    .replace('\"{tileserver_poi}\"', mapStyleConfig.poiMapUrl)\n    .replace('{spriteserver}', mapStyleConfig.spritesUrl)\n    .replace('{fontserver}', mapStyleConfig.fontsUrl)\n  )\n}\n","import { LngLat } from 'mapbox-gl--ENV';\nimport Poi, { POI_TYPE } from './poi';\n\nexport default class MapPoi extends Poi {\n  constructor(feature) {\n    const { global_id, ['class']: className, subclass: subClassName, name } = feature.properties;\n    const ll = LngLat.convert(feature.geometry.coordinates);\n    super(global_id || feature.id, name, POI_TYPE, ll, className, subClassName);\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Popup } from 'mapbox-gl--ENV';\nimport ApiPoi from './poi/idunn_poi';\nimport { isMobileDevice } from 'src/libs/device';\nimport ReactPoiPopup from 'src/components/PoiPopup';\nimport { fire, listen } from 'src/libs/customEvents';\n\nconst WAIT_BEFORE_DISPLAY = 350;\nconst WAIT_BEFORE_CLOSE = 350;\n\nfunction PoiPopup() {\n  return undefined;\n}\n\nPoiPopup.prototype.init = function (map) {\n  this.map = map;\n  this.popupHandle = null;\n  this.timeOutHandler = null;\n  this.activePoiId = null;\n  this.closeTimeoutHandler = null;\n\n  listen('open_popup', (poi, e) => {\n    if (isMobileDevice() || isTouchEvent(e)) {\n      return;\n    }\n    this.createPJPopup(poi, e);\n    fire('stop_close_popup_timeout');\n  });\n  listen('close_popup', () => this.close());\n  listen('clean_marker', () => {\n    this.close();\n    this.activePoiId = null;\n  });\n\n  listen('stop_close_popup_timeout', () => clearTimeout(this.closeTimeoutHandler));\n  listen('start_close_popup_timeout', () => {\n    clearTimeout(this.closeTimeoutHandler);\n    this.closeTimeoutHandler = setTimeout(() => {\n      fire('close_popup');\n    }, WAIT_BEFORE_CLOSE);\n  });\n};\n\nPoiPopup.prototype.addListener = function (layer) {\n  this.map.on('mouseenter', layer, e => {\n    if (isMobileDevice() || isTouchEvent(e)) {\n      return;\n    }\n    this.timeOutHandler = setTimeout(() => {\n      const poi = e.features[0];\n      if (this.activePoiId === poi.properties.global_id) {\n        return;\n      }\n      this.createOSMPopup(poi, e.originalEvent);\n    }, WAIT_BEFORE_DISPLAY);\n  });\n\n  this.map.on('click', () => {\n    this.close();\n  });\n\n  this.map.on('mouseleave', layer, async () => {\n    clearTimeout(this.timeOutHandler);\n    fire('start_close_popup_timeout');\n  });\n};\n\nPoiPopup.prototype.createOSMPopup = async function (layerPoi, event) {\n  const poi = await ApiPoi.poiApiLoad({ id: layerPoi.properties.global_id }, { simple: true });\n  if (poi) {\n    this.showPopup(poi, event);\n  }\n};\n\nPoiPopup.prototype.createPJPopup = function (poi, event) {\n  if (poi) {\n    this.showPopup(poi, event);\n  }\n};\n\nPoiPopup.prototype.showPopup = function (poi, event) {\n  this.close();\n\n  const popupOptions = {\n    className: 'poi_popup__container',\n    closeButton: false,\n    maxWidth: 'none',\n    offset: 18, //px,\n    anchor: this.getPopupAnchor(event),\n  };\n\n  this.popupHandle = new Popup(popupOptions)\n    .setLngLat(poi.latLon)\n    .setHTML('<div class=\"poi_popup__wrapper\"/></div>')\n    .addTo(this.map);\n\n  const popupWrapper = document.querySelector('.poi_popup__wrapper');\n  if (popupWrapper) {\n    ReactDOM.render(<ReactPoiPopup poi={poi} />, popupWrapper);\n  }\n};\n\nPoiPopup.prototype.getPopupAnchor = function (event) {\n  const VERTICAL_OFFSET = 250;\n  const HORIZONTAL_OFFSET = 300;\n  const canvasWidth = window.innerWidth;\n  const anchorFragments = [];\n\n  if (event) {\n    if (event.clientY > VERTICAL_OFFSET) {\n      anchorFragments.push('bottom');\n    } else {\n      anchorFragments.push('top');\n    }\n\n    if (event.clientX < canvasWidth - HORIZONTAL_OFFSET) {\n      anchorFragments.push('left');\n    } else {\n      anchorFragments.push('right');\n    }\n  } else {\n    anchorFragments.push('bottom');\n    anchorFragments.push('left');\n  }\n\n  return anchorFragments.join('-');\n};\n\nPoiPopup.prototype.close = function () {\n  if (this.popupHandle) {\n    fire('stop_close_popup_timeout');\n    const popupWrapper = document.querySelector('.poi_popup__wrapper');\n    if (popupWrapper) {\n      ReactDOM.unmountComponentAtNode(popupWrapper);\n    }\n    this.popupHandle.remove();\n    this.popupHandle = null;\n  }\n};\n\n/* private */\nfunction isTouchEvent(event) {\n  if (event && event.originalEvent && event.originalEvent.sourceCapabilities) {\n    return event.originalEvent.sourceCapabilities.firesTouchEvents === true;\n  }\n  return false;\n}\n\nexport default PoiPopup;\n","import { ACTION_BLUE_BASE, RED_DARKER, GREY_BLACK } from 'src/libs/colors';\n\nexport const getFilteredPoisPinStyle = () => ({\n  type: 'symbol',\n  layout: {\n    'icon-image': ['concat', 'pin-', ['get', 'iconName']],\n    'icon-allow-overlap': true,\n    'icon-ignore-placement': false,\n    'icon-padding': 0,\n    'icon-anchor': 'bottom',\n  },\n  paint: {\n    'icon-opacity': [\n      'case',\n      ['==', ['feature-state', 'selected'], true],\n      0,\n      ['==', ['feature-state', 'hovered'], true],\n      0,\n      1,\n    ],\n  },\n});\n\nexport const getFilteredPoisLabelStyle = () => ({\n  type: 'symbol',\n  layout: {\n    'text-font': ['Noto Sans Bold'],\n    'text-size': 10,\n    'text-field': ['get', 'name'],\n    'text-allow-overlap': false,\n    'text-ignore-placement': false,\n    'text-optional': true,\n    'text-variable-anchor': ['top', 'bottom-left', 'bottom-right'],\n    'text-offset': [1.5, 0.5],\n    'text-justify': 'auto',\n  },\n  paint: {\n    'text-color': ['case', ['==', ['feature-state', 'selected'], true], RED_DARKER, GREY_BLACK],\n    'text-halo-color': 'white',\n    'text-halo-width': 1,\n    'text-translate': [0, -2],\n  },\n});\n\nexport const setPoiHoverStyle = (map, poiLayer) => {\n  if (!map.getPaintProperty) {\n    // @MAPBOX: This method isn't implemented by the Mapbox-GL mock\n    return;\n  }\n  const textColorProperty = map.getPaintProperty(poiLayer, 'text-color');\n  map.setPaintProperty(\n    poiLayer,\n    'text-color',\n    ['case', ['to-boolean', ['feature-state', 'hover']], ACTION_BLUE_BASE, textColorProperty],\n    { validate: false }\n  );\n};\n","import Color from 'color';\nimport {\n  ACTION_BLUE_SEMI_LIGHTNESS,\n  ACTION_BLUE_DARK,\n  GREY_GREY,\n  GREY_SEMI_LIGHTNESS,\n} from 'src/libs/colors';\n\nconst darkenColor = hex => Color(hex).mix(Color('black'), 0.33).hex();\nconst safeHexColor = hex => (hex.charAt(0) === '#' ? hex : `#${hex}`);\n\nexport function prepareRouteColor(feature) {\n  const lineColor = feature.properties?.lineColor;\n  return {\n    ...feature,\n    properties: {\n      ...feature.properties,\n      lineColor: lineColor ? safeHexColor(lineColor) : ACTION_BLUE_SEMI_LIGHTNESS,\n      outlineColor: lineColor ? darkenColor(safeHexColor(lineColor)) : ACTION_BLUE_DARK,\n    },\n  };\n}\n\nfunction getColorExpression(isActive, isOutline) {\n  if (isActive) {\n    return isOutline ? ['get', 'outlineColor'] : ['get', 'lineColor'];\n  }\n  return isOutline ? GREY_GREY : GREY_SEMI_LIGHTNESS;\n}\n\nexport function getRouteStyle(vehicle, isActive, isOutline) {\n  if (vehicle === 'walking') {\n    return {\n      type: 'symbol',\n      layout: {\n        'icon-image': isActive ? 'walking_bullet_active' : 'walking_bullet_inactive',\n        'symbol-placement': 'line',\n        'symbol-spacing': 12,\n        'icon-ignore-placement': true,\n        'icon-allow-overlap': true,\n        'symbol-avoid-edges': true,\n      },\n    };\n  }\n\n  return {\n    type: 'line',\n    layout: {\n      'line-join': 'round',\n      'line-cap': 'round',\n      visibility: 'visible',\n    },\n    paint: {\n      'line-color': getColorExpression(isActive, isOutline),\n      'line-color-transition': { duration: 0 },\n      'line-width': isOutline ? 7 : 5,\n    },\n  };\n}\n\nexport function setActiveRouteStyle(map, layerId, vehicle, isActive, isOutline) {\n  if (vehicle === 'walking') {\n    map.setLayoutProperty(\n      layerId,\n      'icon-image',\n      isActive ? 'walking_bullet_active' : 'walking_bullet_inactive'\n    );\n  } else {\n    map.setPaintProperty(layerId, 'line-color', getColorExpression(isActive, isOutline));\n  }\n}\n","import { Map, Marker, LngLat, setRTLTextPlugin, LngLatBounds } from 'mapbox-gl--ENV';\nimport PoiPopup from './poi_popup';\nimport MobileCompassControl from '../mapbox/mobile_compass_control';\nimport ExtendedControl from '../mapbox/extended_nav_control';\nimport { map as mapConfig } from 'config/constants.yml';\nimport { getCurrentMapPaddings, isPositionUnderUI } from 'src/panel/layouts';\nimport nconf from '@qwant/nconf-getter';\nimport MapPoi from './poi/map_poi';\nimport { getLastLocation, setLastLocation } from 'src/adapters/store';\nimport getStyle from './scene_config';\nimport SceneDirection from './scene_direction';\nimport SceneCategory from './scene_category';\nimport { createDefaultPin } from '../adapters/icon_manager';\nimport LatLonPoi from './poi/latlon_poi';\nimport { isMobileDevice } from 'src/libs/device';\nimport { parseMapHash, getMapHash } from 'src/libs/url_utils';\nimport { parseBboxString } from 'src/libs/bounds';\nimport { toUrl, getBestZoom } from 'src/libs/pois';\nimport Error from 'src/adapters/error';\nimport { fire, listen } from 'src/libs/customEvents';\nimport locale from '../mapbox/locale';\nimport { setPoiHoverStyle } from 'src/adapters/pois_styles';\n\nconst baseUrl = nconf.get().system.baseUrl;\nconst LONG_TOUCH_DELAY_MS = 500;\nconst MOBILE_IDLE_DELAY_MS = 2000;\nlet MOBILE_IDLE_TIMEOUT;\n\nfunction Scene() {\n  this.currentMarker = null;\n  this.popup = new PoiPopup();\n  this.savedLocation = null;\n}\n\nconst getPoiView = poi => ({\n  center: poi.geometry.center,\n  zoom: getBestZoom(poi),\n  bounds: poi.geometry.bbox,\n});\n\nconst hideMobileScale = function () {\n  const item = document.querySelector('.map_control__scale');\n  if (item) {\n    item.classList.add('fadeOut');\n  }\n};\n\nconst showMobileScale = function () {\n  const item = document.querySelector('.map_control__scale');\n  if (item) {\n    item.classList.remove('fadeOut');\n  }\n};\n\nScene.prototype.getMapInitOptions = function ({ locationHash, bbox }) {\n  if (bbox) {\n    try {\n      return { bounds: parseBboxString(bbox) };\n    } catch (e) {\n      console.error(e);\n    }\n  }\n  if (window.hotLoadPoi) {\n    return getPoiView(window.hotLoadPoi);\n  }\n  if (locationHash) {\n    return {\n      zoom: locationHash.zoom,\n      center: [locationHash.lng, locationHash.lat],\n    };\n  }\n  const lastLocation = getLastLocation();\n  if (lastLocation) {\n    return {\n      zoom: lastLocation.zoom,\n      center: [lastLocation.lng, lastLocation.lat],\n    };\n  }\n  if (window.initialBbox) {\n    return {\n      bounds: window.initialBbox,\n      fitBoundsOptions: {\n        maxZoom: 9,\n      },\n    };\n  }\n  return {\n    zoom: mapConfig.zoom,\n    center: [mapConfig.center.lng, mapConfig.center.lat],\n  };\n};\n\nScene.prototype.initMapBox = function ({ locationHash, bbox }) {\n  window.times.initMapBox = Date.now();\n  const compilationHash = window.__config.compilationHash;\n  setRTLTextPlugin(\n    `${baseUrl}statics/build/javascript/map_plugins/mapbox-gl-rtl-text-${compilationHash}.js`,\n    error => {\n      if (error) {\n        Error.send('scene', 'setRTLTextPlugin', 'Failed to load mapbox RTL plugin', error);\n      }\n    },\n    /* lazy */ true\n  );\n\n  this.mb = new Map({\n    attributionControl: false,\n    container: 'scene_container',\n    style: getStyle(),\n    hash: false,\n    maxZoom: 20,\n    locale,\n    ...this.getMapInitOptions({ locationHash, bbox }),\n  });\n  // @MAPBOX: This method isn't implemented by the Mapbox-GL mock\n  this.mb.setPadding = this.mb.setPadding || (() => undefined);\n  this.mb.setPadding(getCurrentMapPaddings());\n\n  this.popup.init(this.mb);\n  window.map = this;\n\n  const interactiveLayers = [\n    'poi-level-1',\n    'poi-level-2',\n    'poi-level-3',\n    'poi-level-public-transports-1',\n    'poi-level-public-transports-2',\n  ];\n  this.hoveredPoi = null;\n\n  // Max time between two touch to be considered a single \"double click\" event\n  // This is the value Mapbox-GL uses, in src/ui/handler/dblclick_zoom.js\n  this.DOUBLE_TAP_DELAY_MS = 300;\n  this.lastDoubleTapTimeStamp = 0;\n  this.lastTouchEndTimeStamp = 0;\n  this.mb.on('touchend', () => {\n    const timeStamp = Date.now();\n    // maybe we should also check the distance between the two touch events\n    if (timeStamp - this.lastTouchEndTimeStamp < this.DOUBLE_TAP_DELAY_MS) {\n      this.lastDoubleTapTimeStamp = timeStamp;\n    }\n    this.lastTouchEndTimeStamp = timeStamp;\n  });\n\n  this.mb.on('load', () => {\n    fire('restart_idle_timeout');\n    this.onHashChange();\n    new SceneDirection(this.mb);\n    new SceneCategory(this.mb);\n\n    this.mb.addControl(new ExtendedControl(), 'bottom-right');\n    this.mb.addControl(new MobileCompassControl(), 'top-right');\n\n    if (!isMobileDevice()) {\n      interactiveLayers.forEach(interactiveLayer => {\n        setPoiHoverStyle(this.mb, interactiveLayer);\n\n        this.mb.on('mouseenter', interactiveLayer, e => {\n          if (e.features.length > 0) {\n            this.hoveredPoi = e.features[0];\n            this.mb.setFeatureState(this.hoveredPoi, { hover: true });\n          }\n          this.mb.getCanvas().style.cursor = 'pointer';\n        });\n\n        this.mb.on('mouseleave', interactiveLayer, () => {\n          if (this.hoveredPoi) {\n            this.mb.setFeatureState(this.hoveredPoi, { hover: false });\n            this.hoveredPoi = null;\n          }\n          this.mb.getCanvas().style.cursor = '';\n        });\n\n        this.popup.addListener(interactiveLayer);\n      });\n    }\n\n    // we have to delay click event resolution to make time for possible double click events,\n    // which are thrown *after* two separate click events are thrown\n    this.clickDelayHandler = null;\n\n    this.mb.on('click', e => {\n      fire('restart_idle_timeout');\n      if (e.originalEvent.cancelBubble) {\n        return;\n      }\n      // cancel the previous click handler if it's still pending\n      clearTimeout(this.clickDelayHandler);\n      // if this is a real mouse double-click, we can simply return here\n      if (e.originalEvent.detail >= 2) {\n        return;\n      }\n      const pois = this.mb.queryRenderedFeatures(e.point, { layers: interactiveLayers });\n      // when clicking on a POI, just trigger the action without delay,\n      // as a subsequent double click isn't a problem\n      if (pois[0]) {\n        this.clickOnMap(e.lngLat, pois[0]);\n        return;\n      }\n      this.clickDelayHandler = setTimeout(() => {\n        // for touch UX we have to make sure a double tap zoom hasn't been made in the meantime\n        if (Date.now() - this.lastDoubleTapTimeStamp < this.DOUBLE_TAP_DELAY_MS) {\n          return;\n        }\n        this.clickOnMap(e.lngLat, null);\n      }, this.DOUBLE_TAP_DELAY_MS);\n    });\n\n    // Long touch polyfill (for mobile devices and touch screens)\n    // Custom implementation because the contextmenu event isn't supported by MapBox.\n    // Long touch is initiated on touchstart event, and canceled if a move, gesture or touchend occurs before 500ms.\n    // Sources:\n    // https://stackoverflow.com/a/1943768 (explanation of 500ms delay)\n    // https://stackoverflow.com/a/54746189 (polyfill implementation also using the 500ms delay)\n\n    let longTouchTimeout = null;\n    this.mb.on('touchstart', e => {\n      fire('restart_idle_timeout');\n      if (e.originalEvent.touches.length === 1) {\n        longTouchTimeout = setTimeout(() => {\n          this.clickOnMap(e.lngLat, null, { longTouch: true });\n          this.cancelClickAfterLongTouch = true;\n        }, LONG_TOUCH_DELAY_MS);\n      }\n    });\n\n    const longTouchCancellingEvents = [\n      'touchend',\n      // 'touchcancel', // ignore this event as it's always thrown by Firefox Android\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=1481923\n      // Doesn't seem to change the behavior for other browsers\n      'touchmove',\n      'pointerdrag',\n      'pointermove',\n      'moveend',\n      'gesturestart',\n      'gesturechange',\n      'gestureend',\n    ];\n\n    const cancelLongTouch = e => {\n      if (longTouchTimeout) {\n        clearTimeout(longTouchTimeout);\n        longTouchTimeout = null;\n      }\n\n      if (this.cancelClickAfterLongTouch) {\n        e.originalEvent.preventDefault();\n        this.cancelClickAfterLongTouch = false;\n      }\n    };\n\n    longTouchCancellingEvents.forEach(event => {\n      this.mb.on(event, cancelLongTouch);\n    });\n\n    this.mb.on('dragstart', () => {\n      fire('map_user_interaction');\n    });\n    this.mb.on('pitchstart', () => {\n      fire('map_user_interaction');\n    });\n\n    this.mb.on('moveend', () => {\n      const { lng, lat } = this.mb.getCenter();\n      const zoom = this.mb.getZoom();\n      setLastLocation({ lng, lat, zoom });\n      window.app.updateHash(this.getLocationHash());\n      fire('map_moveend');\n    });\n\n    window.execOnMapLoaded = f => f();\n    fire('map_loaded');\n  });\n\n  listen('fit_map', (item, forceAnimate) => {\n    this.fitMap(item, forceAnimate);\n  });\n\n  listen('ensure_poi_visible', (poi, options) => {\n    this.ensureMarkerIsVisible(poi, options);\n  });\n\n  listen('create_poi_marker', poi => {\n    this.addMarker(poi);\n  });\n\n  listen('clean_marker', () => {\n    this.cleanMarker();\n  });\n\n  listen('save_location', () => {\n    this.saveLocation();\n  });\n\n  listen('restore_location', () => {\n    this.restoreLocation();\n  });\n\n  listen('move_mobile_bottom_ui', bottom => {\n    this.moveMobileBottomUI(bottom);\n  });\n\n  listen('move_mobile_geolocation_button', bottom => {\n    this.moveMobileGeolocationButton(bottom);\n  });\n\n  listen('mobile_geolocation_button_visibility', visible => {\n    this.mobileButtonVisibility('.mapboxgl-ctrl-geolocate', visible);\n  });\n\n  listen('mobile_direction_button_visibility', visible => {\n    this.mobileButtonVisibility('.direction_shortcut', visible);\n  });\n\n  listen('update_map_paddings', () => {\n    this.mb.setPadding(getCurrentMapPaddings());\n  });\n};\n\nScene.prototype.clickOnMap = function (lngLat, clickedFeature, { longTouch = false } = {}) {\n  // Instantiate the place clicked as a PoI\n  const poi = clickedFeature ? new MapPoi(clickedFeature) : new LatLonPoi(lngLat);\n\n  if (document.querySelector('.directions-open')) {\n    // If Direction panel is open, tell it to fill its fields with this PoI\n    fire('set_direction_point', poi);\n  } else if (isMobileDevice() && !clickedFeature && !longTouch) {\n    // On mobile, simple clicks anywhere don't do anything\n    return;\n  } else {\n    // Default case: open the POI panel\n    window.app.navigateTo(`/place/${toUrl(poi)}`, { poi });\n  }\n};\n\nScene.prototype.saveLocation = function () {\n  this.savedLocation = this.getLocationHash();\n};\n\nScene.prototype.restoreLocation = function () {\n  if (this.savedLocation) {\n    const { zoom, lat, lng } = parseMapHash(this.savedLocation);\n    const flyOptions = {\n      center: [lng, lat],\n      zoom,\n      animate: true,\n      screenSpeed: 2,\n    };\n    this.mb.flyTo(flyOptions);\n  }\n};\n\nconst clamp = (min, max, value) => Math.min(max, Math.max(min, value));\n\nScene.prototype.isBBoxInExtendedViewport = function (bbox) {\n  const viewport = this.mb.getBounds();\n\n  const width = viewport.getEast() - viewport.getWest();\n  const height = viewport.getNorth() - viewport.getSouth();\n\n  // Compute extended viewport, with lats between -85 and 85\n  viewport.setNorthEast(\n    new LngLat(viewport.getEast() + width, clamp(-85, 85, viewport.getNorth() + height)).wrap()\n  );\n  viewport.setSouthWest(\n    new LngLat(viewport.getWest() - width, clamp(-85, 85, viewport.getSouth() - height)).wrap()\n  );\n\n  // Check if the bbox overlaps the viewport\n  return (\n    viewport.contains(bbox.getNorthWest()) ||\n    viewport.contains(bbox.getNorthEast()) ||\n    viewport.contains(bbox.getSouthEast()) ||\n    viewport.contains(bbox.getSouthWest())\n  );\n};\n\nScene.prototype.fitBbox = function (bbox, forceAnimate) {\n  // normalise bbox\n  if (bbox instanceof Array) {\n    bbox = new LngLatBounds(bbox);\n  }\n\n  // Animate if the zoom is big enough and if the BBox is (partially or fully) in\n  // the extended viewport.\n  const animate = forceAnimate || (this.mb.getZoom() > 10 && this.isBBoxInExtendedViewport(bbox));\n  this.mb.fitBounds(bbox, { animate });\n};\n\n// Move the map to focus on an item\nScene.prototype.fitMap = function (item, forceAnimate) {\n  // BBox\n  if (item instanceof LngLatBounds || Array.isArray(item)) {\n    this.fitBbox(item, forceAnimate);\n  } else {\n    // PoI\n    if (item.bbox) {\n      // poi Bbox\n      this.fitBbox(item.bbox, forceAnimate);\n    } else {\n      // poi center\n      const flyOptions = {\n        center: item.latLon,\n        zoom: getBestZoom(item),\n        screenSpeed: 1.5,\n        animate: false,\n      };\n\n      if (forceAnimate || (this.mb.getZoom() > 10 && this.isWindowedPoi(item))) {\n        flyOptions.animate = true;\n      }\n      this.mb.flyTo(flyOptions);\n    }\n  }\n};\n\nScene.prototype.ensureMarkerIsVisible = function (poi, options) {\n  if (poi.bbox) {\n    this.fitBbox(poi.bbox);\n    return;\n  }\n  const isMobile = isMobileDevice();\n  if (!options.centerMap) {\n    const isPoiUnderPanel = isPositionUnderUI(this.mb.project(poi.latLon), { isMobile });\n    if (this.isWindowedPoi(poi) && !isPoiUnderPanel) {\n      return;\n    }\n  }\n  this.mb.flyTo({\n    center: poi.latLon,\n    zoom: getBestZoom(poi),\n    maxDuration: 1200,\n  });\n};\n\nScene.prototype.addMarker = function (poi) {\n  const element = createDefaultPin();\n  element.onclick = function (e) {\n    // click event should not be propagated to the map itself;\n    e.stopPropagation();\n  };\n\n  if (this.currentMarker !== null) {\n    this.currentMarker.remove();\n  }\n\n  const marker = new Marker({ element, anchor: 'bottom', offset: [0, -5] })\n    .setLngLat(poi.latLon)\n    .addTo(this.mb);\n  this.currentMarker = marker;\n  return marker;\n};\n\nScene.prototype.cleanMarker = async function () {\n  if (this.currentMarker !== null) {\n    this.currentMarker.remove();\n    this.currentMarker = null;\n  }\n};\n\nScene.prototype.isWindowedPoi = function (poi) {\n  return this.mb.getBounds().contains(new LngLat(poi.latLon.lng, poi.latLon.lat));\n};\n\nScene.prototype.getLocationHash = function () {\n  const { lat, lng } = this.mb.getCenter();\n  return getMapHash(this.mb.getZoom(), lat, lng);\n};\n\nScene.prototype.restoreFromHash = function (hash, options = {}) {\n  const zll = parseMapHash(hash);\n  if (!zll) {\n    return;\n  }\n  const { zoom, lat, lng } = zll;\n  this.mb.flyTo({ zoom, center: [lng, lat], ...options });\n};\n\nScene.prototype.onHashChange = function () {\n  window.onhashchange = () => {\n    this.restoreFromHash(window.location.hash, { animate: false });\n  };\n};\n\nScene.prototype.translateUIControl = function (selector, bottom) {\n  const item = document.querySelector(selector);\n  if (item) {\n    item.style.transform = `translateY(${-bottom}px)`;\n  }\n};\n\nScene.prototype.moveMobileBottomUI = function (bottom = 0) {\n  if (!isMobileDevice() && bottom > 0) {\n    return;\n  }\n  const uiControls = [\n    '.map_control__scale_attribute_container',\n    '.mapboxgl-ctrl-geolocate',\n    '.direction_shortcut',\n  ];\n  uiControls.forEach(uiControl => {\n    this.translateUIControl(uiControl, bottom);\n  });\n};\n\nScene.prototype.moveMobileGeolocationButton = function (bottom = 0) {\n  if (!isMobileDevice() && bottom > 0) {\n    return;\n  }\n  this.translateUIControl('.mapboxgl-ctrl-geolocate', bottom);\n};\n\nScene.prototype.mobileButtonVisibility = function (selector, visible) {\n  if (!isMobileDevice()) {\n    return;\n  }\n  const item = document.querySelector(selector);\n  if (item) {\n    if (visible) {\n      item.classList.remove('hidden');\n    } else {\n      item.classList.add('hidden');\n    }\n  }\n};\n\nlisten('restart_idle_timeout', () => {\n  // Cancel idle status\n  showMobileScale();\n  clearTimeout(MOBILE_IDLE_TIMEOUT);\n\n  // Start a new 2s idle timeout\n  MOBILE_IDLE_TIMEOUT = setTimeout(() => {\n    hideMobileScale();\n  }, MOBILE_IDLE_DELAY_MS);\n});\n\nexport default Scene;\n","import nconf from '@qwant/nconf-getter';\nimport { Marker } from 'mapbox-gl--ENV';\nimport constants from '../../config/constants.yml';\nimport Telemetry from 'src/libs/telemetry';\nimport { toUrl } from 'src/libs/pois';\nimport { fire, listen } from 'src/libs/customEvents';\nimport { poiToGeoJSON, emptyFeatureCollection } from 'src/libs/geojson';\nimport { getFilteredPoisPinStyle, getFilteredPoisLabelStyle } from 'src/adapters/pois_styles';\nimport { isMobileDevice } from 'src/libs/device';\nimport { createMapGLIcon, createPinIcon } from 'src/adapters/icon_manager';\nimport IconManager from 'src/adapters/icon_manager';\n\nconst mapStyleConfig = nconf.get().mapStyle;\n\nconst poisToGeoJSON = pois => {\n  return {\n    type: 'FeatureCollection',\n    features: pois.map(poi => {\n      const poiFeature = poiToGeoJSON(poi);\n      poiFeature.properties.iconName = IconManager.get(poi).iconClass;\n      return poiFeature;\n    }),\n  };\n};\n\nexport default class SceneCategory {\n  constructor(map) {\n    this.map = map;\n    this.sourceName = 'poi-filtered';\n    this.layers = [];\n\n    this.initActiveStateMarkers();\n    this.initDynamicPoiLayers();\n\n    listen('add_category_markers', this.addCategoryMarkers);\n    listen('remove_category_markers', this.removeCategoryMarkers);\n    listen('highlight_category_marker', this.highlightPoiMarker);\n    listen('click_category_marker', this.selectPoiMarker);\n    listen('click_category_poi', this.selectPoi);\n    listen('clean_marker', () => this.selectPoiMarker(null));\n  }\n\n  initActiveStateMarkers = () => {\n    this.hoveredPoi = null;\n    this.hoveredMarker = new Marker({\n      element: createPinIcon({ disablePointerEvents: true, className: 'marker--category' }),\n      anchor: 'bottom',\n    });\n    this.selectedPoi = null;\n    this.selectedMarker = new Marker({\n      element: createPinIcon({ className: 'marker--category' }),\n      anchor: 'bottom',\n    });\n  };\n\n  initDynamicPoiLayers = () => {\n    // Declare a new image in MapBox-GL rasters so it can be used in the layer style\n    createMapGLIcon('./statics/images/map/pin_map_dot.svg', 50, 60).then(imageData => {\n      this.map.addImage('pin_with_dot', imageData);\n    });\n\n    this.map.addSource(this.sourceName, {\n      type: 'geojson',\n      data: emptyFeatureCollection,\n      // tells MapBox-GL to use this property as internal feature identifier\n      promoteId: 'id',\n    });\n\n    if (mapStyleConfig.showNamesWithPins) {\n      const labelLayerId = `${this.sourceName}_labels`;\n      this.map.addLayer({\n        ...getFilteredPoisLabelStyle(),\n        source: this.sourceName,\n        id: labelLayerId,\n      });\n      this.layers.push(labelLayerId);\n    }\n\n    const pinLayerId = `${this.sourceName}_pins`;\n    this.map.addLayer({\n      ...getFilteredPoisPinStyle(),\n      source: this.sourceName,\n      id: pinLayerId,\n    });\n    this.layers.push(pinLayerId);\n\n    this.layers.forEach(layerName => {\n      this.map.on('click', layerName, this.handleLayerMarkerClick);\n      if (!isMobileDevice()) {\n        this.map.on('mouseover', layerName, this.handleLayerMarkerMouseOver);\n        this.map.on('mouseleave', layerName, this.handleLayerMarkerMouseLeave);\n      }\n    });\n  };\n\n  getPointedPoi = mapMouseEvent => {\n    const feature = mapMouseEvent.features[0];\n    return feature && this.pois.find(p => p.id === feature.id);\n  };\n\n  selectPoi = ({ poi, poiFilters, pois }) => {\n    if (poi.meta && poi.meta.source) {\n      Telemetry.sendPoiEvent(\n        poi,\n        'open',\n        Telemetry.buildInteractionData({\n          id: poi.id,\n          source: poi.meta.source,\n          template: 'multiple',\n          zone: 'list',\n          element: 'item',\n          category: poiFilters.category,\n        })\n      );\n    }\n    window.app.navigateTo(`/place/${toUrl(poi)}`, {\n      poi,\n      poiFilters,\n      pois,\n      centerMap: true,\n    });\n    this.selectPoiMarker(poi);\n  };\n\n  handleLayerMarkerClick = e => {\n    e.originalEvent.stopPropagation();\n    const poi = this.getPointedPoi(e);\n\n    this.selectPoi({\n      poi,\n      pois: this.pois,\n      poiFilters: this.poiFilters,\n    });\n  };\n\n  handleLayerMarkerMouseOver = e => {\n    this.map.getCanvas().style.cursor = 'pointer';\n    const poi = this.getPointedPoi(e);\n    if (this.selectedPoi?.id !== poi.id) {\n      this.highlightPoiMarker(poi, true);\n      fire('open_popup', poi, e.originalEvent);\n    }\n  };\n\n  handleLayerMarkerMouseLeave = () => {\n    this.map.getCanvas().style.cursor = '';\n    this.highlightPoiMarker(this.hoveredPoi, false);\n    // delay the popup closure so it can be hovered\n    fire('start_close_popup_timeout');\n  };\n\n  addCategoryMarkers = (pois = [], poiFilters) => {\n    fire('close_popup');\n    this.pois = pois;\n    this.poiFilters = poiFilters;\n    this.setOsmPoisVisibility(false);\n    this.map.getSource(this.sourceName).setData(poisToGeoJSON(pois));\n    this.layers.forEach(layerName => {\n      this.map.setLayoutProperty(layerName, 'visibility', 'visible');\n    });\n  };\n\n  removeCategoryMarkers = () => {\n    fire('close_popup');\n    this.selectPoiMarker(null);\n    this.highlightPoiMarker(this.hoveredPoi, false);\n    this.layers.forEach(layerName => {\n      this.map.setLayoutProperty(layerName, 'visibility', 'none');\n    });\n    this.setOsmPoisVisibility(true);\n  };\n\n  setOsmPoisVisibility = displayed => {\n    constants.map.pois_layers.map(poi => {\n      this.map.setLayoutProperty(poi, 'visibility', displayed ? 'visible' : 'none');\n    });\n  };\n\n  setPoiFeatureState = (id, state) => {\n    this.map.setFeatureState({ id, source: this.sourceName }, state);\n  };\n\n  highlightPoiMarker = (poi, highlight) => {\n    if (this.hoveredPoi) {\n      this.setPoiFeatureState(this.hoveredPoi.id, { hovered: false });\n    }\n    if (highlight) {\n      this.hoveredPoi = poi;\n      this.hoveredMarker.setLngLat(poi.latLon).addTo(this.map);\n      this.setPoiFeatureState(this.hoveredPoi.id, { hovered: true });\n    } else {\n      this.hoveredMarker.remove();\n      this.hoveredPoi = null;\n    }\n  };\n\n  selectPoiMarker = poi => {\n    if (this.selectedPoi === poi) {\n      return;\n    }\n    if (this.selectedPoi) {\n      this.setPoiFeatureState(this.selectedPoi.id, { selected: false });\n    }\n    if (poi) {\n      this.selectedPoi = poi;\n      this.selectedMarker.setLngLat(poi.latLon).addTo(this.map);\n      this.setPoiFeatureState(this.selectedPoi.id, { selected: true });\n    } else {\n      this.selectedMarker.remove();\n      this.selectedPoi = null;\n    }\n  };\n}\n","import nconf from '@qwant/nconf-getter';\nimport configure from '@qwant/mapbox_style_configure';\nimport URI from '@qwant/uri';\nimport qwantStyle from '@qwant/qwant-basic-gl-style/style.json';\n\nconst mapStyleConfig = nconf.get().mapStyle;\nconst baseUrl = nconf.get().system.baseUrl;\n\nfunction sceneConfig() {\n  return Object.assign(mapStyleConfig, {\n    spritesUrl: URI.toAbsoluteUrl(location.origin, baseUrl, mapStyleConfig.spritesUrl),\n    fontsUrl: URI.toAbsoluteUrl(location.origin, baseUrl, mapStyleConfig.fontsUrl),\n  });\n}\n\nexport default function getStyle() {\n  return configure(JSON.stringify(qwantStyle), sceneConfig(), window.getBaseLang().code);\n}\n","import React from 'react';\nimport RouteLabel from 'src/panel/direction/RouteLabel';\nimport { Marker, LngLatBounds } from 'mapbox-gl--ENV';\nimport bbox from '@turf/bbox';\nimport { normalizeToFeatureCollection } from 'src/libs/geojson';\nimport { map } from '../../config/constants.yml';\nimport LatLonPoi from '../adapters/poi/latlon_poi';\nimport { prepareRouteColor, getRouteStyle, setActiveRouteStyle } from './route_styles';\nimport { getAllSteps, getAllStops, originDestinationCoords } from 'src/libs/route_utils';\nimport Error from '../adapters/error';\nimport nconf from '@qwant/nconf-getter';\nimport { fire, listen } from 'src/libs/customEvents';\nimport { getLabelPositions } from 'alt-route-labeller';\nimport { isMobileDevice } from 'src/libs/device';\nimport renderStaticReact from 'src/libs/renderStaticReact';\n\nconst createMarker = (lngLat, className = '', options = {}) => {\n  const element = document.createElement('div');\n  element.className = className;\n  return new Marker({ ...options, element }).setLngLat(lngLat);\n};\n\nconst createRouteLabel = (route, vehicle, { lngLat, anchor }) => {\n  const element = document.createElement('div');\n  element.innerHTML = renderStaticReact(\n    <RouteLabel route={route} vehicle={vehicle} anchor={anchor} />\n  );\n  element.className = 'routeLabel-marker';\n  element.onclick = () => {\n    fire('select_road_map', route.id);\n  };\n  return new Marker({ element, anchor }).setLngLat(lngLat);\n};\n\nconst getLabelsBbbox = (labelPositions, routesBbox) => {\n  const smallScreen = isMobileDevice();\n  const shift = {\n    latShift: (routesBbox.getNorth() - routesBbox.getSouth()) / (smallScreen ? 5 : 10),\n    lngShift: (routesBbox.getEast() - routesBbox.getWest()) / (smallScreen ? 3 : 10),\n  };\n  const labelsBbbox = new LngLatBounds();\n  labelPositions.map(shiftLabelPosition(shift)).forEach(labelPosition => {\n    labelsBbbox.extend(labelPosition);\n  });\n  return labelsBbbox;\n};\n\nconst shiftLabelPosition = ({ lngShift, latShift }) => ({ lngLat, anchor }) => {\n  let [lng, lat] = lngLat;\n  if (anchor === 'top') {\n    lat -= latShift;\n  } else if (anchor === 'bottom') {\n    lat += latShift;\n  } else if (anchor === 'left') {\n    lng += lngShift;\n  } else if (anchor === 'right') {\n    lng -= lngShift;\n  }\n  return [lng, lat];\n};\n\nexport default class SceneDirection {\n  constructor(map) {\n    this.map = map;\n    this.routes = [];\n    this.routeMarkers = [];\n    this.routeLabels = [];\n    this.fullBbox = null;\n    this.mapFeaturesByRoute = {};\n\n    const iconsBaseUrl = nconf.get().system.baseUrl + 'statics/images/direction_icons';\n    this.addMapImage(`${iconsBaseUrl}/walking_bullet_active.png`, 'walking_bullet_active', {\n      pixelRatio: 4,\n    });\n    this.addMapImage(`${iconsBaseUrl}/walking_bullet_inactive.png`, 'walking_bullet_inactive', {\n      pixelRatio: 4,\n    });\n\n    listen('set_routes', ({ routes, vehicle, activeRouteId = 0 }) => {\n      this.reset();\n      this.routes = routes;\n      this.vehicle = vehicle;\n      this.displayRoutes(activeRouteId);\n    });\n\n    listen('set_main_route', ({ routeId, fitView }) => {\n      this.setMainRoute(routeId, fitView);\n    });\n\n    listen('clean_routes', () => {\n      this.reset();\n    });\n\n    listen('zoom_step', step => {\n      fire('fit_map', this.computeBBox(step));\n    });\n\n    listen('highlight_step', step => {\n      this.highlightStep(step);\n    });\n\n    listen('unhighlight_step', step => {\n      this.unhighlightStep(step);\n    });\n\n    listen('set_origin', poi => {\n      this.setOrigin(poi);\n    });\n\n    listen('set_destination', poi => {\n      this.setDestination(poi);\n    });\n  }\n\n  setOrigin = poi => {\n    const originMarker = createMarker(poi.latLon, 'itinerary_marker_origin', {\n      draggable: !isMobileDevice(),\n    })\n      .addTo(this.map)\n      .on('dragend', event => {\n        this.refreshDirection('origin', event.target.getLngLat());\n      });\n    this.routeMarkers.push(originMarker);\n  };\n\n  setDestination = poi => {\n    const destinationMarker = createMarker(poi.latLon, 'itinerary_marker_destination', {\n      draggable: !isMobileDevice(),\n      anchor: 'bottom',\n    })\n      .addTo(this.map)\n      .on('dragend', event => {\n        this.refreshDirection('destination', event.target.getLngLat());\n      });\n    this.routeMarkers.push(destinationMarker);\n  };\n\n  addMarkerSteps(route) {\n    if (this.vehicle !== 'walking' && this.vehicle !== 'publicTransport') {\n      getAllSteps(route).forEach((step, idx) => {\n        const stepMarker = createMarker(step.maneuver.location, 'itinerary_marker_step');\n        stepMarker.getElement().id = 'itinerary_marker_step_' + idx;\n        this.routeMarkers.push(stepMarker.addTo(this.map));\n      });\n    }\n\n    if (this.vehicle === 'publicTransport') {\n      getAllStops(route).forEach((stop, idx) => {\n        const stopMarker = createMarker(stop.location, 'itinerary_marker_step');\n        stopMarker.getElement().id = 'itinerary_marker_stop_' + idx;\n        stopMarker.getElement().title = stop.name;\n        this.routeMarkers.push(stopMarker.addTo(this.map));\n      });\n    }\n  }\n\n  setMainRoute(routeId, fitView) {\n    let mainRoute = null;\n    if (this.routes.length === 0) {\n      return;\n    }\n\n    this.routes.forEach(route => {\n      const isActive = route.id === routeId;\n      if (isActive) {\n        mainRoute = route;\n      }\n      this.mapFeaturesByRoute[route.id].forEach(({ layerId, outlineLayerId, vehicle }) => {\n        setActiveRouteStyle(this.map, layerId, vehicle, isActive, false);\n        if (outlineLayerId) {\n          setActiveRouteStyle(this.map, outlineLayerId, vehicle, isActive, true);\n        }\n        if (isActive) {\n          if (outlineLayerId) {\n            this.map.moveLayer(outlineLayerId, map.routes_layer);\n          }\n          this.map.moveLayer(layerId, map.routes_layer);\n        }\n      });\n    });\n    this.updateMarkers(mainRoute);\n    this.updateRouteLabels(mainRoute);\n    if (fitView && this.fullBbox) {\n      fire('fit_map', this.fullBbox);\n    }\n  }\n\n  updateMarkers(mainRoute) {\n    if (!mainRoute) {\n      return;\n    }\n\n    this.routeMarkers.forEach(marker => {\n      marker.remove();\n    });\n    this.routeMarkers = [];\n\n    this.addMarkerSteps(mainRoute);\n    const { origin, destination } = originDestinationCoords(mainRoute);\n\n    this.setOrigin({ latLon: { lng: origin[0], lat: origin[1] } });\n\n    this.setDestination({ latLon: { lng: destination[0], lat: destination[1] } });\n  }\n\n  displayRoutes(activeRouteId) {\n    if (this.routes && this.routes.length > 0) {\n      // route lines\n      this.mapFeaturesByRoute = {};\n      this.routes.forEach(route => {\n        this.mapFeaturesByRoute[route.id] = this.addRouteFeatures(\n          route,\n          route.id === activeRouteId\n        );\n      });\n      // route labels\n      const labelPositions = getLabelPositions(this.routes.map(route => route.geometry));\n      this.routeLabels = labelPositions.map(({ lngLat, anchor }, index) =>\n        createRouteLabel(this.routes[index], this.vehicle, { lngLat, anchor }).addTo(this.map)\n      );\n      // compute and store the best bbox\n      const routesBbox = new LngLatBounds();\n      this.routes.forEach(route => {\n        routesBbox.extend(this.computeBBox(route));\n      });\n      this.fullBbox = routesBbox.extend(getLabelsBbbox(labelPositions, routesBbox));\n\n      this.setMainRoute(activeRouteId, true);\n    }\n  }\n\n  updateRouteLabels({ id: activeRouteId }) {\n    // @IE11: array spread to convert NodeList to an array\n    [...document.querySelectorAll('.routeLabel')].forEach(routeLabel => {\n      if (routeLabel.dataset.id === activeRouteId.toString()) {\n        routeLabel.classList.add('active');\n      } else {\n        routeLabel.classList.remove('active');\n      }\n    });\n  }\n\n  refreshDirection(type, lngLat) {\n    const newPoint = new LatLonPoi(lngLat);\n    fire('change_direction_point', type, '', newPoint);\n  }\n\n  reset() {\n    this.routes.forEach(route => {\n      this.mapFeaturesByRoute[route.id].forEach(({ outlineLayerId, layerId, sourceId }) => {\n        if (outlineLayerId) {\n          this.map.removeLayer(outlineLayerId);\n        }\n        this.map.removeLayer(layerId);\n        this.map.removeSource(sourceId);\n      });\n    });\n    this.routes = [];\n\n    this.routeMarkers.concat(this.routeLabels).forEach(marker => {\n      marker.remove();\n    });\n    this.routeMarkers = [];\n    this.routeLabels = [];\n    this.fullBbox = null;\n  }\n\n  getDataSources(route) {\n    const featureCollection = normalizeToFeatureCollection(route.geometry);\n    const sources = [];\n    const walkFeatures = [],\n      nonWalkFeatures = [];\n    featureCollection.features.forEach(feature => {\n      if (\n        this.vehicle === 'walking' ||\n        (this.vehicle === 'publicTransport' && feature.properties.mode === 'WALK')\n      ) {\n        walkFeatures.push(feature);\n      } else {\n        nonWalkFeatures.push(prepareRouteColor(feature));\n      }\n    });\n\n    if (walkFeatures.length > 0) {\n      sources.push({\n        vehicle: 'walking',\n        data: { type: 'FeatureCollection', features: walkFeatures },\n      });\n    }\n\n    if (nonWalkFeatures.length > 0) {\n      sources.push({\n        vehicle: this.vehicle,\n        data: { type: 'FeatureCollection', features: nonWalkFeatures },\n      });\n    }\n\n    return sources;\n  }\n\n  addRouteFeatures(route, isActive) {\n    const sources = this.getDataSources(route);\n    return sources.map((source, idx) => {\n      const sourceId = `source_${route.id}_${idx}`;\n      this.map.addSource(sourceId, { type: 'geojson', data: source.data });\n\n      const layerId = `route_${route.id}_${idx}`;\n      const layerStyle = {\n        ...getRouteStyle(source.vehicle, isActive, false),\n        id: layerId,\n        source: sourceId,\n      };\n\n      let outlineLayerId;\n      if (source.vehicle !== 'walking') {\n        outlineLayerId = layerId + '_outline';\n        const outlineLayerStyle = {\n          ...getRouteStyle(source.vehicle, isActive, true),\n          id: layerId + '_outline',\n          source: sourceId,\n        };\n        this.map.addLayer(outlineLayerStyle, map.routes_layer);\n      }\n\n      this.map\n        .addLayer(layerStyle, map.routes_layer)\n        .on('click', layerId, () => {\n          fire('select_road_map', route.id);\n        })\n        .on('mouseenter', layerId, () => {\n          this.map.getCanvas().style.cursor = 'pointer';\n        })\n        .on('mouseleave', layerId, () => {\n          this.map.getCanvas().style.cursor = '';\n        });\n\n      return { sourceId, layerId, outlineLayerId, vehicle: source.vehicle };\n    });\n  }\n\n  computeBBox({ geometry }) {\n    const [minX, minY, maxX, maxY] = bbox(geometry);\n    return new LngLatBounds([minX, minY], [maxX, maxY]);\n  }\n\n  highlightStep(step) {\n    const marker = document.querySelector('#itinerary_marker_step_' + step);\n    if (marker) {\n      marker.classList.add('itinerary_marker_step--highlighted');\n    }\n  }\n\n  unhighlightStep(step) {\n    const marker = document.querySelector('#itinerary_marker_step_' + step);\n    if (marker) {\n      marker.classList.remove('itinerary_marker_step--highlighted');\n    }\n  }\n\n  addMapImage(url, name, options = {}) {\n    this.map.loadImage(url, (error, image) => {\n      if (error) {\n        Error.sendOnce('scene', 'initMapBox', `Failed to load image at ${url}`, error);\n        return;\n      }\n      this.map.addImage(name, image, options);\n    });\n  }\n}\n","import React from 'react';\nimport PoiItem from './PoiItem';\nimport { fire } from 'src/libs/customEvents';\nimport ActionButtons from '../panel/poi/ActionButtons';\nimport Telemetry from '../libs/telemetry';\nimport { useConfig, useFavorites } from '../hooks';\n\nconst PoiPopup = ({ poi }) => {\n  const { isInFavorites, removeFromFavorites, addToFavorites } = useFavorites();\n  const isDirectionActive = useConfig('direction').enabled;\n\n  const openDirection = () => {\n    Telemetry.sendPoiEvent(poi, 'itinerary');\n    window.app.navigateTo('/routes/', { poi });\n  };\n\n  const onClickPhoneNumber = () => {\n    const source = poi.meta && poi.meta.source;\n    if (source) {\n      Telemetry.sendPoiEvent(\n        poi,\n        'phone',\n        Telemetry.buildInteractionData({\n          id: poi.id,\n          source,\n          template: 'single',\n          zone: 'detail',\n          element: 'phone',\n        })\n      );\n    }\n  };\n\n  const toggleStorePoi = () => {\n    const isFavorite = isInFavorites(poi);\n    Telemetry.sendPoiEvent(poi, 'favorite', { stored: !isFavorite });\n    if (isFavorite) {\n      removeFromFavorites(poi);\n    } else {\n      addToFavorites(poi);\n    }\n  };\n\n  return (\n    <div\n      className=\"poi_popup\"\n      onMouseEnter={() => {\n        fire('stop_close_popup_timeout');\n      }}\n      onMouseLeave={() => {\n        fire('close_popup');\n      }}\n    >\n      <div className=\"u-mb-s\">\n        <PoiItem poi={poi} withOpeningHours withImage inList />\n      </div>\n      <ActionButtons\n        poi={poi}\n        isDirectionActive={isDirectionActive}\n        openDirection={openDirection}\n        onClickPhoneNumber={onClickPhoneNumber}\n        isPoiInFavorite={isInFavorites(poi)}\n        toggleStorePoi={toggleStorePoi}\n      />\n    </div>\n  );\n};\n\nexport default PoiPopup;\n","import ReactDOMServer from 'react-dom/server';\n\nexport default reactElement => ReactDOMServer.renderToStaticMarkup(reactElement);\n","import { AttributionControl } from 'mapbox-gl--ENV';\n\n/**\n * Override default control to pass a container\n * in constructor and register a onReady cb\n */\nexport default class ExtendedAttributionControl extends AttributionControl {\n  constructor(options, container) {\n    super(options);\n    this.parentContainer = container;\n  }\n\n  onAdd(map) {\n    const container = super.onAdd(map);\n    if (container) {\n      this.parentContainer.appendChild(container);\n    }\n    return this.parentContainer;\n  }\n}\n","import React from 'react';\nimport * as Geolocation from '../libs/geolocation';\nimport Telemetry from '../libs/telemetry';\nimport { openPendingGeolocateModal } from 'src/modals/GeolocationModal';\nimport * as store from 'src/adapters/store';\nimport renderStaticReact from 'src/libs/renderStaticReact';\nimport { IconGeoloc } from 'src/components/ui/icons';\nimport { isMobileDevice } from 'src/libs/device';\n\nimport { GeolocateControl } from 'mapbox-gl--ENV';\n\n/**\n * Override default GeolocateControl\n */\n\nexport default class ExtendedGeolocateControl extends GeolocateControl {\n  constructor(options, container) {\n    super(options);\n    this._container = container;\n    this.on('trackuserlocationstart', () => {\n      Telemetry.addOnce(Telemetry.LOCALISE_TRIGGER);\n    });\n  }\n\n  onAdd(map) {\n    this._map = map;\n    this._setupUI();\n    return this._container;\n  }\n\n  onReady(cb) {\n    this._onReady = cb;\n  }\n\n  async trigger() {\n    const state = await Geolocation.getGeolocationPermission();\n    if (\n      state === Geolocation.geolocationPermissions.PROMPT &&\n      !store.get('has_geolocate_modal_opened_once')\n    ) {\n      await openPendingGeolocateModal();\n      store.set('has_geolocate_modal_opened_once', true);\n    }\n    super.trigger();\n  }\n\n  _setupUI(supported) {\n    super._setupUI(supported);\n    if (this._geolocateButton?.firstChild) {\n      this._geolocateButton.firstChild.innerHTML = renderStaticReact(\n        <IconGeoloc fill=\"currentColor\" width={isMobileDevice() ? 24 : 16} />\n      );\n    }\n    this._onReady();\n  }\n\n  _onError(error) {\n    Geolocation.handleError(error);\n    super._onError(error);\n    // MapboxGL implementation disables the button after an error,\n    // but we won't the user to always have feedback with relevant links\n    // so override this behavior\n    this._geolocateButton.disabled = false;\n  }\n}\n","import React from 'react';\nimport ExtendedScaleControl from './extended_scale_control';\nimport ExtendedAttributionControl from './extended_attribution_control';\nimport GeolocControl from './extended_geolocate_control';\nimport Telemetry from 'src/libs/telemetry';\nimport { listen, unListen } from '../libs/customEvents';\nimport renderStaticReact from 'src/libs/renderStaticReact';\nimport { IconPlus, IconMinus } from 'src/components/ui/icons';\n\nexport default class ExtendedControl {\n  constructor() {\n    this._container = document.createElement('div');\n    this.topButtonGroup = document.createElement('div');\n    this.bottomButtonGroup = document.createElement('div');\n\n    // Store a callback to trigger when direction shortcut is clicked.\n    // if no callback is registered, then the default action will be executed\n    // (navigate to /routes)\n    this.directionShortcutCallback = null;\n    listen('set_direction_shortcut_callback', cb => (this.directionShortcutCallback = cb));\n\n    this._zoomInButton = this._createButton(\n      'map_control_group__button__zoom map-button--zoomIn',\n      'Zoom +',\n      () => {\n        Telemetry.add(Telemetry.MAP_ZOOM_IN);\n        this._map.zoomIn();\n      }\n    );\n    this._zoomInButton.innerHTML = renderStaticReact(<IconPlus fill=\"currentColor\" width={16} />);\n\n    this._zoomOutButton = this._createButton(\n      'map_control_group__button__zoom map-button--zoomOut',\n      'Zoom -',\n      () => {\n        Telemetry.add(Telemetry.MAP_ZOOM_OUT);\n        this._map.zoomOut();\n      }\n    );\n    this._zoomOutButton.innerHTML = renderStaticReact(<IconMinus fill=\"currentColor\" width={16} />);\n\n    const compassClass = 'map_control_group__button__compass';\n    this._compass = this._createButton(compassClass, 'Reset North', () => {\n      this._resetNorthAndTilt();\n    });\n    this._direction = this._createButton('direction_shortcut hidden', 'direction', () => {\n      Telemetry.add(Telemetry.MAP_ITINERARY);\n      this.directionShortcutCallback\n        ? this.directionShortcutCallback()\n        : window.app.navigateTo('/routes'); // default action, if no cb has been set\n    });\n\n    this._compassIndicator = this._createIcon('map_control__compass__icon');\n    this._compass.appendChild(this._compassIndicator);\n  }\n\n  onAdd(map) {\n    this._map = map;\n    this.topButtonGroup.className = 'map_control_group';\n    this.topButtonGroup.textContent = '';\n    this.bottomButtonGroup.className = 'map_control_group map_bottom_button_group mapboxgl-ctrl';\n    this.bottomButtonGroup.textContent = '';\n\n    const geolocControl = new GeolocControl(\n      {\n        positionOptions: {\n          enableHighAccuracy: true,\n        },\n        trackUserLocation: true,\n        showAccuracyCircle: false,\n      },\n      this.bottomButtonGroup\n    );\n\n    this.topButtonGroup.appendChild(this._compass);\n    this.topButtonGroup.appendChild(this._direction);\n\n    geolocControl.onReady(() => {\n      this.bottomButtonGroup.appendChild(this._zoomInButton);\n      this.bottomButtonGroup.appendChild(this._zoomOutButton);\n    });\n\n    this._map.addControl(geolocControl);\n\n    const _pitchAndRotateCompassArrow = this._pitchAndRotateCompassArrow.bind(this);\n\n    _pitchAndRotateCompassArrow();\n\n    this._map.on('rotate', _pitchAndRotateCompassArrow);\n    this._map.on('pitch', _pitchAndRotateCompassArrow);\n\n    this.scaleAttributionContainer = document.createElement('div');\n    this.scaleAttributionContainer.className = 'map_control__scale_attribute_container';\n    this._container.appendChild(this.scaleAttributionContainer);\n\n    const extendedScaleControl = new ExtendedScaleControl(\n      {\n        unit: 'metric',\n      },\n      this.scaleAttributionContainer\n    );\n\n    const extendedAttributionControl = new ExtendedAttributionControl(\n      {},\n      this.scaleAttributionContainer\n    );\n    this._container.appendChild(this.topButtonGroup);\n    this._container.appendChild(this.bottomButtonGroup);\n\n    this._container.appendChild(this.scaleAttributionContainer);\n    this._map.addControl(extendedScaleControl, 'bottom-right');\n    this._map.addControl(extendedAttributionControl, 'bottom-right');\n    return this._container;\n  }\n\n  onRemove() {\n    this._container.parentNode.removeChild(this._container);\n    this._map = undefined;\n    unListen('set_direction_shortcut_callback');\n  }\n\n  _createButton(className, ariaLabel, fn) {\n    const a = document.createElement('button');\n    a.setAttribute('class', className);\n    a.setAttribute('aria-label', ariaLabel);\n    a.setAttribute('title', ariaLabel);\n    a.addEventListener('click', fn);\n    return a;\n  }\n\n  _createIcon(className) {\n    const a = document.createElement('span');\n    a.setAttribute('class', className);\n    return a;\n  }\n\n  _resetNorthAndTilt() {\n    this._map.easeTo({ pitch: 0, bearing: 0 });\n  }\n\n  _pitchAndRotateCompassArrow() {\n    if (this._map.getPitch() === 0 && this._map.transform.angle === 0) {\n      this._compass.classList.add('compass-origin');\n    } else {\n      this._compass.classList.remove('compass-origin');\n    }\n    const scale = 1 - this._map.getPitch() / 110;\n    const rotation = this._map.transform.angle * (180 / Math.PI);\n    this._compassIndicator.style.transform = `scale(1, ${scale}) rotate(${rotation}deg)`;\n  }\n}\n","import { ScaleControl } from 'mapbox-gl--ENV';\n\n/**\n * Override default control to pass a container\n * in constructor and register a onReady cb\n */\nexport default class ExtendedScaleControl extends ScaleControl {\n  constructor(options, container) {\n    super(options);\n    this.parentContainer = container;\n  }\n\n  onAdd(map) {\n    this._map = map;\n    this._container = document.createElement('div');\n    this._container.className = 'mapboxgl-ctrl mapboxgl-ctrl-scale map_control__scale';\n\n    this.parentContainer.appendChild(this._container);\n\n    this._map.on('move', this._onMove);\n    super._onMove();\n\n    return this.parentContainer;\n  }\n}\n","/* global _ */\n\nconst defaultLocale = {\n  'GeolocateControl.FindMyLocation': _('My location', 'mapbox'),\n};\n\nexport default defaultLocale;\n","export default class MobileCompassControl {\n  constructor() {\n    this._container = document.createElement('div');\n    const compassClass = 'map_control_group__button__compass--mobile';\n    this._compass = this._createButton(compassClass, 'Reset North', () => {\n      this._resetNorthAndTilt();\n    });\n\n    const compassIndicatorClass = 'map_control__compass__icon map_control__compass__icon--mobile';\n    this._compassIndicator = this._createIcon(compassIndicatorClass);\n    this._compass.appendChild(this._compassIndicator);\n  }\n\n  onAdd(map) {\n    this._map = map;\n    this._container.className = 'map_control_group';\n    this._container.textContent = '';\n    this._container.appendChild(this._compass);\n    const _pitchAndRotateCompassArrow = this._pitchAndRotateCompassArrow.bind(this);\n\n    _pitchAndRotateCompassArrow();\n\n    this._map.on('rotate', _pitchAndRotateCompassArrow);\n    this._map.on('pitch', _pitchAndRotateCompassArrow);\n\n    return this._container;\n  }\n\n  onRemove() {\n    this._container.parentNode.removeChild(this._container);\n    this._map = undefined;\n  }\n\n  _geolocate() {\n    navigator.geolocation.getCurrentPosition(\n      position => {\n        this._map.flyTo({ center: [position.coords.longitude, position.coords.latitude] });\n      },\n      () => undefined,\n      { maximumAge: 10000 }\n    );\n  }\n\n  _createButton(className, ariaLabel, fn) {\n    const a = document.createElement('button');\n    a.setAttribute('class', className);\n    a.setAttribute('aria-label', ariaLabel);\n    a.addEventListener('click', fn);\n    this._container.appendChild(a);\n    return a;\n  }\n\n  _createIcon(className) {\n    const a = document.createElement('span');\n    a.setAttribute('class', className);\n    return a;\n  }\n\n  _resetNorthAndTilt() {\n    this._map.easeTo({ pitch: 0, bearing: 0 });\n  }\n\n  _pitchAndRotateCompassArrow() {\n    if (this._map.getPitch() === 0 && this._map.transform.angle === 0) {\n      this._compass.classList.add('compass-origin');\n    } else {\n      this._compass.classList.remove('compass-origin');\n    }\n    const scale = 1 - this._map.getPitch() / 110;\n    const rotation = this._map.transform.angle * (180 / Math.PI);\n    this._compassIndicator.style.transform = `scale(1, ${scale}) rotate(${rotation}deg)`;\n  }\n}\n","import React from 'react';\nimport { formatDistance, formatDuration } from 'src/libs/route_utils';\nimport VehicleIcon from './VehicleIcon';\n\nconst VEHICLES = {\n  TRAIN: 'train',\n  SUBWAY: 'metro',\n  BUS_CITY: 'bus',\n  TRAM: 'tram',\n};\n\nconst PublicTransportIcon = ({ mode }) => (\n  <div className={`publicTransportLabelItem roadmapIcon roadmapIcon--${VEHICLES[mode]}`} />\n);\n\nconst PublicTransportStepIcons = ({ route }) => {\n  const nonWalkLegs = route.legs.filter(leg => leg.mode !== 'WALK');\n\n  if (nonWalkLegs.length <= 3) {\n    return (\n      <div>\n        {nonWalkLegs.map((leg, index) => (\n          <PublicTransportIcon key={index} mode={leg.mode} />\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <PublicTransportIcon mode={nonWalkLegs[0].mode} />\n      <div className=\"publicTransportLabelItem roadmapIcon u-text--caption roadmapIcon--inbetween\">\n        <div>+{nonWalkLegs.length - 2}</div>\n      </div>\n      <PublicTransportIcon mode={nonWalkLegs[nonWalkLegs.length - 1].mode} />\n    </div>\n  );\n};\n\nconst RouteLabel = ({ route, vehicle, anchor }) => {\n  const isPublicTransport = vehicle === 'publicTransport';\n  return (\n    <div data-id={route.id} className={`routeLabel routeLabel--${anchor} routeLabel--${vehicle}`}>\n      {isPublicTransport ? (\n        <PublicTransportStepIcons route={route} />\n      ) : (\n        <div className=\"routeLabel-vehicleIcon\">\n          <VehicleIcon vehicle={vehicle} fill=\"currentColor\" width={24} />\n        </div>\n      )}\n      <div>\n        <div className=\"routeLabel-duration\">{formatDuration(route.duration)}</div>\n        {!isPublicTransport && (\n          <div className=\"routeLabel-distance\">{formatDistance(route.distance)}</div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default RouteLabel;\n"],"sourceRoot":""}